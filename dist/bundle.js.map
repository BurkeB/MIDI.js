{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/tunajs/tuna.js","src/lib/Base64binary.js","src/lib/WebMIDIAPI.js","src/main.js","src/midi/audioDetect.js","src/midi/gm.js","src/midi/loader.js","src/midi/plugin.audiotag.js","src/midi/plugin.webaudio.js","src/midi/plugin.webmidi.js","src/util/dom_request_script.js","src/util/dom_request_xhr.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACroEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*\n    Copyright (c) 2012 DinahMoe AB & Oskar Eriksson\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation\n    files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy,\n    modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software\n    is furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n    DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE\n    OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n(function(window) {\n    var userContext,\n        userInstance,\n        pipe = function(param, val) {\n            param.value = val;\n        },\n        Super = Object.create(null, {\n            activate: {\n                writable: true,\n                value: function(doActivate) {\n                    if (doActivate) {\n                        this.input.disconnect();\n                        this.input.connect(this.activateNode);\n                        if (this.activateCallback) {\n                            this.activateCallback(doActivate);\n                        }\n                    } else {\n                        this.input.disconnect();\n                        this.input.connect(this.output);\n                    }\n                }\n            },\n            bypass: {\n                get: function() {\n                    return this._bypass;\n                },\n                set: function(value) {\n                    if (this._lastBypassValue === value) {\n                        return;\n                    }\n                    this._bypass = value;\n                    this.activate(!value);\n                    this._lastBypassValue = value;\n                }\n            },\n            connect: {\n                value: function(target) {\n                    this.output.connect(target);\n                }\n            },\n            disconnect: {\n                value: function(target) {\n                    this.output.disconnect(target);\n                }\n            },\n            connectInOrder: {\n                value: function(nodeArray) {\n                    var i = nodeArray.length - 1;\n                    while (i--) {\n                        if (!nodeArray[i].connect) {\n                            return console.error(\"AudioNode.connectInOrder: TypeError: Not an AudioNode.\", nodeArray[i]);\n                        }\n                        if (nodeArray[i + 1].input) {\n                            nodeArray[i].connect(nodeArray[i + 1].input);\n                        } else {\n                            nodeArray[i].connect(nodeArray[i + 1]);\n                        }\n                    }\n                }\n            },\n            getDefaults: {\n                value: function() {\n                    var result = {};\n                    for (var key in this.defaults) {\n                        result[key] = this.defaults[key].value;\n                    }\n                    return result;\n                }\n            },\n            automate: {\n                value: function(property, value, duration, startTime) {\n                    var start = startTime ? ~~(startTime / 1000) : userContext.currentTime,\n                        dur = duration ? ~~(duration / 1000) : 0,\n                        _is = this.defaults[property],\n                        param = this[property],\n                        method;\n\n                    if (param) {\n                        if (_is.automatable) {\n                            if (!duration) {\n                                method = \"setValueAtTime\";\n                            } else {\n                                method = \"linearRampToValueAtTime\";\n                                param.cancelScheduledValues(start);\n                                param.setValueAtTime(param.value, start);\n                            }\n                            param[method](value, dur + start);\n                        } else {\n                            param = value;\n                        }\n                    } else {\n                        console.error(\"Invalid Property for \" + this.name);\n                    }\n                }\n            }\n        }),\n        FLOAT = \"float\",\n        BOOLEAN = \"boolean\",\n        STRING = \"string\",\n        INT = \"int\";\n\n    if (typeof module !== \"undefined\" && module.exports) {\n        module.exports = Tuna;\n    } else if (typeof define === \"function\") {\n        window.define(\"Tuna\", definition);\n    } else {\n        window.Tuna = Tuna;\n    }\n\n    function definition() {\n        return Tuna;\n    }\n\n    function Tuna(context) {\n        if (!(this instanceof Tuna)) {\n            return new Tuna(context);\n        }\n        if (!window.AudioContext) {\n            window.AudioContext = window.webkitAudioContext;\n        }\n        if (!context) {\n            console.log(\"tuna.js: Missing audio context! Creating a new context for you.\");\n            context = window.AudioContext && (new window.AudioContext());\n        }\n        if (!context) {\n            throw new Error(\"Tuna cannot initialize because this environment does not support web audio.\");\n        }\n        connectify(context);\n        userContext = context;\n        userInstance = this;\n    }\n\n    function connectify(context) {\n        if (context.__connectified__ === true) return;\n\n        var gain = context.createGain(),\n            proto = Object.getPrototypeOf(Object.getPrototypeOf(gain)),\n            oconnect = proto.connect;\n\n        proto.connect = shimConnect;\n        context.__connectified__ = true; // Prevent overriding connect more than once\n\n        function shimConnect() {\n            var node = Array.prototype.shift.apply(arguments);\n            node = Super.isPrototypeOf ? (Super.isPrototypeOf(node) ? node.input : node) : (node.input || node);\n            arguments = Array.prototype.slice.call(arguments);\n            arguments.unshift(node);\n            oconnect.apply(this, arguments);\n            return node;\n        }\n    }\n\n    function dbToWAVolume(db) {\n        return Math.max(0, Math.round(100 * Math.pow(2, db / 6)) / 100);\n    }\n\n    function fmod(x, y) {\n        // http://kevin.vanzonneveld.net\n        // *     example 1: fmod(5.7, 1.3);\n        // *     returns 1: 0.5\n        var tmp, tmp2, p = 0,\n            pY = 0,\n            l = 0.0,\n            l2 = 0.0;\n\n        tmp = x.toExponential().match(/^.\\.?(.*)e(.+)$/);\n        p = parseInt(tmp[2], 10) - (tmp[1] + \"\").length;\n        tmp = y.toExponential().match(/^.\\.?(.*)e(.+)$/);\n        pY = parseInt(tmp[2], 10) - (tmp[1] + \"\").length;\n\n        if (pY > p) {\n            p = pY;\n        }\n\n        tmp2 = (x % y);\n\n        if (p < -100 || p > 20) {\n            // toFixed will give an out of bound error so we fix it like this:\n            l = Math.round(Math.log(tmp2) / Math.log(10));\n            l2 = Math.pow(10, l);\n\n            return (tmp2 / l2).toFixed(l - p) * l2;\n        } else {\n            return parseFloat(tmp2.toFixed(-p));\n        }\n    }\n\n    function sign(x) {\n        if (x === 0) {\n            return 1;\n        } else {\n            return Math.abs(x) / x;\n        }\n    }\n\n    function tanh(n) {\n        return (Math.exp(n) - Math.exp(-n)) / (Math.exp(n) + Math.exp(-n));\n    }\n\n    function initValue(userVal, defaultVal) {\n        return userVal === undefined ? defaultVal : userVal;\n    }\n\n    Tuna.prototype.Bitcrusher = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.bufferSize = properties.bufferSize || this.defaults.bufferSize.value;\n\n        this.input = userContext.createGain();\n        this.activateNode = userContext.createGain();\n        this.processor = userContext.createScriptProcessor(this.bufferSize, 1, 1);\n        this.output = userContext.createGain();\n\n        this.activateNode.connect(this.processor);\n        this.processor.connect(this.output);\n\n        var phaser = 0,\n            last = 0,\n            input, output, step, i, length;\n        this.processor.onaudioprocess = function(e) {\n            input = e.inputBuffer.getChannelData(0),\n            output = e.outputBuffer.getChannelData(0),\n            step = Math.pow(1 / 2, this.bits);\n            length = input.length;\n            for (i = 0; i < length; i++) {\n                phaser += this.normfreq;\n                if (phaser >= 1.0) {\n                    phaser -= 1.0;\n                    last = step * Math.floor(input[i] / step + 0.5);\n                }\n                output[i] = last;\n            }\n        };\n\n        this.bits = properties.bits || this.defaults.bits.value;\n        this.normfreq = initValue(properties.normfreq, this.defaults.normfreq.value);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Bitcrusher.prototype = Object.create(Super, {\n        name: {\n            value: \"Bitcrusher\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                bits: {\n                    value: 4,\n                    min: 1,\n                    max: 16,\n                    automatable: false,\n                    type: INT\n                },\n                bufferSize: {\n                    value: 4096,\n                    min: 256,\n                    max: 16384,\n                    automatable: false,\n                    type: INT\n                },\n                bypass: {\n                    value: true,\n                    automatable: false,\n                    type: BOOLEAN\n                },\n                normfreq: {\n                    value: 0.1,\n                    min: 0.0001,\n                    max: 1.0,\n                    automatable: false,\n                    type: FLOAT\n                }\n            }\n        },\n        bits: {\n            enumerable: true,\n            get: function() {\n                return this.processor.bits;\n            },\n            set: function(value) {\n                this.processor.bits = value;\n            }\n        },\n        normfreq: {\n            enumerable: true,\n            get: function() {\n                return this.processor.normfreq;\n            },\n            set: function(value) {\n                this.processor.normfreq = value;\n            }\n        }\n    });\n\n    Tuna.prototype.Cabinet = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.activateNode = userContext.createGain();\n        this.convolver = this.newConvolver(properties.impulsePath ||\n            \"../impulses/impulse_guitar.wav\");\n        this.makeupNode = userContext.createGain();\n        this.output = userContext.createGain();\n\n        this.activateNode.connect(this.convolver.input);\n        this.convolver.output.connect(this.makeupNode);\n        this.makeupNode.connect(this.output);\n\n        this.makeupGain = initValue(properties.makeupGain, this.defaults\n            .makeupGain);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Cabinet.prototype = Object.create(Super, {\n        name: {\n            value: \"Cabinet\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                makeupGain: {\n                    value: 1,\n                    min: 0,\n                    max: 20,\n                    automatable: true,\n                    type: FLOAT\n                },\n                bypass: {\n                    value: false,\n                    automatable: false,\n                    type: BOOLEAN\n                }\n            }\n        },\n        makeupGain: {\n            enumerable: true,\n            get: function() {\n                return this.makeupNode.gain;\n            },\n            set: function(value) {\n                this.makeupNode.gain.value = value;\n            }\n        },\n        newConvolver: {\n            value: function(impulsePath) {\n                return new userInstance.Convolver({\n                    impulse: impulsePath,\n                    dryLevel: 0,\n                    wetLevel: 1\n                });\n            }\n        }\n    });\n\n    Tuna.prototype.Chorus = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.attenuator = this.activateNode = userContext.createGain();\n        this.splitter = userContext.createChannelSplitter(2);\n        this.delayL = userContext.createDelay();\n        this.delayR = userContext.createDelay();\n        this.feedbackGainNodeLR = userContext.createGain();\n        this.feedbackGainNodeRL = userContext.createGain();\n        this.merger = userContext.createChannelMerger(2);\n        this.output = userContext.createGain();\n\n        this.lfoL = new userInstance.LFO({\n            target: this.delayL.delayTime,\n            callback: pipe\n        });\n        this.lfoR = new userInstance.LFO({\n            target: this.delayR.delayTime,\n            callback: pipe\n        });\n\n        this.input.connect(this.attenuator);\n        this.attenuator.connect(this.output);\n        this.attenuator.connect(this.splitter);\n        this.splitter.connect(this.delayL, 0);\n        this.splitter.connect(this.delayR, 1);\n        this.delayL.connect(this.feedbackGainNodeLR);\n        this.delayR.connect(this.feedbackGainNodeRL);\n        this.feedbackGainNodeLR.connect(this.delayR);\n        this.feedbackGainNodeRL.connect(this.delayL);\n        this.delayL.connect(this.merger, 0, 0);\n        this.delayR.connect(this.merger, 0, 1);\n        this.merger.connect(this.output);\n\n        this.feedback = initValue(properties.feedback, this.defaults.feedback\n            .value);\n        this.rate = initValue(properties.rate, this.defaults.rate.value);\n        this.delay = initValue(properties.delay, this.defaults.delay.value);\n        this.depth = initValue(properties.depth, this.defaults.depth.value);\n        this.lfoR.phase = Math.PI / 2;\n        this.attenuator.gain.value = 0.6934; // 1 / (10 ^ (((20 * log10(3)) / 3) / 20))\n        this.lfoL.activate(true);\n        this.lfoR.activate(true);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Chorus.prototype = Object.create(Super, {\n        name: {\n            value: \"Chorus\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                feedback: {\n                    value: 0.4,\n                    min: 0,\n                    max: 0.95,\n                    automatable: false,\n                    type: FLOAT\n                },\n                delay: {\n                    value: 0.0045,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                depth: {\n                    value: 0.7,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                rate: {\n                    value: 1.5,\n                    min: 0,\n                    max: 8,\n                    automatable: false,\n                    type: FLOAT\n                },\n                bypass: {\n                    value: true,\n                    automatable: false,\n                    type: BOOLEAN\n                }\n            }\n        },\n        delay: {\n            enumerable: true,\n            get: function() {\n                return this._delay;\n            },\n            set: function(value) {\n                this._delay = 0.0002 * (Math.pow(10, value) * 2);\n                this.lfoL.offset = this._delay;\n                this.lfoR.offset = this._delay;\n                this._depth = this._depth;\n            }\n        },\n        depth: {\n            enumerable: true,\n            get: function() {\n                return this._depth;\n            },\n            set: function(value) {\n                this._depth = value;\n                this.lfoL.oscillation = this._depth * this._delay;\n                this.lfoR.oscillation = this._depth * this._delay;\n            }\n        },\n        feedback: {\n            enumerable: true,\n            get: function() {\n                return this._feedback;\n            },\n            set: function(value) {\n                this._feedback = value;\n                this.feedbackGainNodeLR.gain.value = this._feedback;\n                this.feedbackGainNodeRL.gain.value = this._feedback;\n            }\n        },\n        rate: {\n            enumerable: true,\n            get: function() {\n                return this._rate;\n            },\n            set: function(value) {\n                this._rate = value;\n                this.lfoL.frequency = this._rate;\n                this.lfoR.frequency = this._rate;\n            }\n        }\n    });\n\n    Tuna.prototype.Compressor = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.compNode = this.activateNode = userContext.createDynamicsCompressor();\n        this.makeupNode = userContext.createGain();\n        this.output = userContext.createGain();\n\n        this.compNode.connect(this.makeupNode);\n        this.makeupNode.connect(this.output);\n\n        this.automakeup = initValue(properties.automakeup, this.defaults\n            .automakeup\n            .value);\n        this.makeupGain = properties.makeupGain || this.defaults.makeupGain\n            .value;\n        this.threshold = initValue(properties.threshold, this.defaults.threshold\n            .value);\n        this.release = properties.release || this.defaults.release.value;\n        this.attack = initValue(properties.attack, this.defaults.attack\n            .value);\n        this.ratio = properties.ratio || this.defaults.ratio.value;\n        this.knee = initValue(properties.knee, this.defaults.knee.value);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Compressor.prototype = Object.create(Super, {\n        name: {\n            value: \"Compressor\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                threshold: {\n                    value: -20,\n                    min: -60,\n                    max: 0,\n                    automatable: true,\n                    type: FLOAT\n                },\n                release: {\n                    value: 250,\n                    min: 10,\n                    max: 2000,\n                    automatable: true,\n                    type: FLOAT\n                },\n                makeupGain: {\n                    value: 1,\n                    min: 1,\n                    max: 100,\n                    automatable: true,\n                    type: FLOAT\n                },\n                attack: {\n                    value: 1,\n                    min: 0,\n                    max: 1000,\n                    automatable: true,\n                    type: FLOAT\n                },\n                ratio: {\n                    value: 4,\n                    min: 1,\n                    max: 50,\n                    automatable: true,\n                    type: FLOAT\n                },\n                knee: {\n                    value: 5,\n                    min: 0,\n                    max: 40,\n                    automatable: true,\n                    type: FLOAT\n                },\n                automakeup: {\n                    value: false,\n                    automatable: false,\n                    type: BOOLEAN\n                },\n                bypass: {\n                    value: true,\n                    automatable: false,\n                    type: BOOLEAN\n                }\n            }\n        },\n        computeMakeup: {\n            value: function() {\n                var magicCoefficient = 4,\n                    // raise me if the output is too hot\n                    c = this.compNode;\n                return -(c.threshold.value - c.threshold.value /\n                        c.ratio.value) /\n                    magicCoefficient;\n            }\n        },\n        automakeup: {\n            enumerable: true,\n            get: function() {\n                return this._automakeup;\n            },\n            set: function(value) {\n                this._automakeup = value;\n                if (this._automakeup) this.makeupGain = this.computeMakeup();\n            }\n        },\n        threshold: {\n            enumerable: true,\n            get: function() {\n                return this.compNode.threshold;\n            },\n            set: function(value) {\n                this.compNode.threshold.value = value;\n                if (this._automakeup) this.makeupGain = this.computeMakeup();\n            }\n        },\n        ratio: {\n            enumerable: true,\n            get: function() {\n                return this.compNode.ratio;\n            },\n            set: function(value) {\n                this.compNode.ratio.value = value;\n                if (this._automakeup) this.makeupGain = this.computeMakeup();\n            }\n        },\n        knee: {\n            enumerable: true,\n            get: function() {\n                return this.compNode.knee;\n            },\n            set: function(value) {\n                this.compNode.knee.value = value;\n                if (this._automakeup) this.makeupGain = this.computeMakeup();\n            }\n        },\n        attack: {\n            enumerable: true,\n            get: function() {\n                return this.compNode.attack;\n            },\n            set: function(value) {\n                this.compNode.attack.value = value / 1000;\n            }\n        },\n        release: {\n            enumerable: true,\n            get: function() {\n                return this.compNode.release;\n            },\n            set: function(value) {\n                this.compNode.release = value / 1000;\n            }\n        },\n        makeupGain: {\n            enumerable: true,\n            get: function() {\n                return this.makeupNode.gain;\n            },\n            set: function(value) {\n                this.makeupNode.gain.value = dbToWAVolume(value);\n            }\n        }\n    });\n\n    Tuna.prototype.Convolver = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.activateNode = userContext.createGain();\n        this.convolver = userContext.createConvolver();\n        this.dry = userContext.createGain();\n        this.filterLow = userContext.createBiquadFilter();\n        this.filterHigh = userContext.createBiquadFilter();\n        this.wet = userContext.createGain();\n        this.output = userContext.createGain();\n\n        this.activateNode.connect(this.filterLow);\n        this.activateNode.connect(this.dry);\n        this.filterLow.connect(this.filterHigh);\n        this.filterHigh.connect(this.convolver);\n        this.convolver.connect(this.wet);\n        this.wet.connect(this.output);\n        this.dry.connect(this.output);\n\n        this.dryLevel = initValue(properties.dryLevel, this.defaults.dryLevel\n            .value);\n        this.wetLevel = initValue(properties.wetLevel, this.defaults.wetLevel\n            .value);\n        this.highCut = properties.highCut || this.defaults.highCut.value;\n        this.buffer = properties.impulse ||\n            \"../impulses/ir_rev_short.wav\";\n        this.lowCut = properties.lowCut || this.defaults.lowCut.value;\n        this.level = initValue(properties.level, this.defaults.level.value);\n        this.filterHigh.type = \"lowpass\";\n        this.filterLow.type = \"highpass\";\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Convolver.prototype = Object.create(Super, {\n        name: {\n            value: \"Convolver\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                highCut: {\n                    value: 22050,\n                    min: 20,\n                    max: 22050,\n                    automatable: true,\n                    type: FLOAT\n                },\n                lowCut: {\n                    value: 20,\n                    min: 20,\n                    max: 22050,\n                    automatable: true,\n                    type: FLOAT\n                },\n                dryLevel: {\n                    value: 1,\n                    min: 0,\n                    max: 1,\n                    automatable: true,\n                    type: FLOAT\n                },\n                wetLevel: {\n                    value: 1,\n                    min: 0,\n                    max: 1,\n                    automatable: true,\n                    type: FLOAT\n                },\n                level: {\n                    value: 1,\n                    min: 0,\n                    max: 1,\n                    automatable: true,\n                    type: FLOAT\n                }\n            }\n        },\n        lowCut: {\n            get: function() {\n                return this.filterLow.frequency;\n            },\n            set: function(value) {\n                this.filterLow.frequency.value = value;\n            }\n        },\n        highCut: {\n            get: function() {\n                return this.filterHigh.frequency;\n            },\n            set: function(value) {\n                this.filterHigh.frequency.value = value;\n            }\n        },\n        level: {\n            get: function() {\n                return this.output.gain;\n            },\n            set: function(value) {\n                this.output.gain.value = value;\n            }\n        },\n        dryLevel: {\n            get: function() {\n                return this.dry.gain\n            },\n            set: function(value) {\n                this.dry.gain.value = value;\n            }\n        },\n        wetLevel: {\n            get: function() {\n                return this.wet.gain;\n            },\n            set: function(value) {\n                this.wet.gain.value = value;\n            }\n        },\n        buffer: {\n            enumerable: false,\n            get: function() {\n                return this.convolver.buffer;\n            },\n            set: function(impulse) {\n                var convolver = this.convolver,\n                    xhr = new XMLHttpRequest();\n                if (!impulse) {\n                    console.log(\"Tuna.Convolver.setBuffer: Missing impulse path!\");\n                    return;\n                }\n                xhr.open(\"GET\", impulse, true);\n                xhr.responseType = \"arraybuffer\";\n                xhr.onreadystatechange = function() {\n                    if (xhr.readyState === 4) {\n                        if (xhr.status < 300 && xhr.status > 199 || xhr.status === 302) {\n                            userContext.decodeAudioData(xhr.response, function(buffer) {\n                                convolver.buffer = buffer;\n                            }, function(e) {\n                                if (e) console.log(\"Tuna.Convolver.setBuffer: Error decoding data\" + e);\n                            });\n                        }\n                    }\n                };\n                xhr.send(null);\n            }\n        }\n    });\n\n    Tuna.prototype.Delay = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.activateNode = userContext.createGain();\n        this.dry = userContext.createGain();\n        this.wet = userContext.createGain();\n        this.filter = userContext.createBiquadFilter();\n        this.delay = userContext.createDelay();\n        this.feedbackNode = userContext.createGain();\n        this.output = userContext.createGain();\n\n        this.activateNode.connect(this.delay);\n        this.activateNode.connect(this.dry);\n        this.delay.connect(this.filter);\n        this.filter.connect(this.feedbackNode);\n        this.feedbackNode.connect(this.delay);\n        this.feedbackNode.connect(this.wet);\n        this.wet.connect(this.output);\n        this.dry.connect(this.output);\n\n        this.delayTime = properties.delayTime || this.defaults.delayTime.value;\n        this.feedback = initValue(properties.feedback, this.defaults.feedback.value);\n        this.wetLevel = initValue(properties.wetLevel, this.defaults.wetLevel.value);\n        this.dryLevel = initValue(properties.dryLevel, this.defaults.dryLevel.value);\n        this.cutoff = properties.cutoff || this.defaults.cutoff.value;\n        this.filter.type = \"lowpass\";\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Delay.prototype = Object.create(Super, {\n        name: {\n            value: \"Delay\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                delayTime: {\n                    value: 100,\n                    min: 20,\n                    max: 1000,\n                    automatable: false,\n                    type: FLOAT\n                },\n                feedback: {\n                    value: 0.45,\n                    min: 0,\n                    max: 0.9,\n                    automatable: true,\n                    type: FLOAT\n                },\n                cutoff: {\n                    value: 20000,\n                    min: 20,\n                    max: 20000,\n                    automatable: true,\n                    type: FLOAT\n                },\n                wetLevel: {\n                    value: 0.5,\n                    min: 0,\n                    max: 1,\n                    automatable: true,\n                    type: FLOAT\n                },\n                dryLevel: {\n                    value: 1,\n                    min: 0,\n                    max: 1,\n                    automatable: true,\n                    type: FLOAT\n                }\n            }\n        },\n        delayTime: {\n            enumerable: true,\n            get: function() {\n                return this.delay.delayTime;\n            },\n            set: function(value) {\n                this.delay.delayTime.value = value / 1000;\n            }\n        },\n        wetLevel: {\n            enumerable: true,\n            get: function() {\n                return this.wet.gain;\n            },\n            set: function(value) {\n                this.wet.gain.value = value;\n            }\n        },\n        dryLevel: {\n            enumerable: true,\n            get: function() {\n                return this.dry.gain;\n            },\n            set: function(value) {\n                this.dry.gain.value = value;\n            }\n        },\n        feedback: {\n            enumerable: true,\n            get: function() {\n                return this.feedbackNode.gain;\n            },\n            set: function(value) {\n                this.feedbackNode.gain.value = value;\n            }\n        },\n        cutoff: {\n            enumerable: true,\n            get: function() {\n                return this.filter.frequency;\n            },\n            set: function(value) {\n                this.filter.frequency.value = value;\n            }\n        }\n    });\n\n    Tuna.prototype.Filter = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.activateNode = userContext.createGain();\n        this.filter = userContext.createBiquadFilter();\n        this.output = userContext.createGain();\n\n        this.activateNode.connect(this.filter);\n        this.filter.connect(this.output);\n\n        this.frequency = properties.frequency || this.defaults.frequency\n            .value;\n        this.Q = properties.resonance || this.defaults.Q.value;\n        this.filterType = initValue(properties.filterType, this.defaults\n            .filterType\n            .value);\n        this.gain = initValue(properties.gain, this.defaults.gain.value);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Filter.prototype = Object.create(Super, {\n        name: {\n            value: \"Filter\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                frequency: {\n                    value: 800,\n                    min: 20,\n                    max: 22050,\n                    automatable: true,\n                    type: FLOAT\n                },\n                Q: {\n                    value: 1,\n                    min: 0.001,\n                    max: 100,\n                    automatable: true,\n                    type: FLOAT\n                },\n                gain: {\n                    value: 0,\n                    min: -40,\n                    max: 40,\n                    automatable: true,\n                    type: FLOAT\n                },\n                bypass: {\n                    value: true,\n                    automatable: false,\n                    type: BOOLEAN\n                },\n                filterType: {\n                    value: \"lowpass\",\n                    automatable: false,\n                    type: STRING\n                }\n            }\n        },\n        filterType: {\n            enumerable: true,\n            get: function() {\n                return this.filter.type;\n            },\n            set: function(value) {\n                this.filter.type = value;\n            }\n        },\n        Q: {\n            enumerable: true,\n            get: function() {\n                return this.filter.Q;\n            },\n            set: function(value) {\n                this.filter.Q.value = value;\n            }\n        },\n        gain: {\n            enumerable: true,\n            get: function() {\n                return this.filter.gain;\n            },\n            set: function(value) {\n                this.filter.gain.value = value;\n            }\n        },\n        frequency: {\n            enumerable: true,\n            get: function() {\n                return this.filter.frequency;\n            },\n            set: function(value) {\n                this.filter.frequency.value = value;\n            }\n        }\n    });\n\n    Tuna.prototype.MoogFilter = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.bufferSize = properties.bufferSize || this.defaults.bufferSize\n            .value;\n\n        this.input = userContext.createGain();\n        this.activateNode = userContext.createGain();\n        this.processor = userContext.createScriptProcessor(this.bufferSize,\n            1,\n            1);\n        this.output = userContext.createGain();\n\n        this.activateNode.connect(this.processor);\n        this.processor.connect(this.output);\n\n        var in1, in2, in3, in4, out1, out2, out3, out4;\n        in1 = in2 = in3 = in4 = out1 = out2 = out3 = out4 = 0.0;\n        var input, output, f, fb, i, length;\n        this.processor.onaudioprocess = function(e) {\n            input = e.inputBuffer.getChannelData(0),\n                output = e.outputBuffer.getChannelData(0),\n                f = this.cutoff * 1.16,\n                inputFactor = 0.35013 * (f * f) * (f * f);\n            fb = this.resonance * (1.0 - 0.15 * f * f);\n            length = input.length;\n            for (i = 0; i < length; i++) {\n                input[i] -= out4 * fb;\n                input[i] *= inputFactor;\n                out1 = input[i] + 0.3 * in1 + (1 - f) * out1; // Pole 1\n                in1 = input[i];\n                out2 = out1 + 0.3 * in2 + (1 - f) * out2; // Pole 2\n                in2 = out1;\n                out3 = out2 + 0.3 * in3 + (1 - f) * out3; // Pole 3\n                in3 = out2;\n                out4 = out3 + 0.3 * in4 + (1 - f) * out4; // Pole 4\n                in4 = out3;\n                output[i] = out4;\n            }\n        };\n\n        this.cutoff = initValue(properties.cutoff, this.defaults.cutoff\n            .value);\n        this.resonance = initValue(properties.resonance, this.defaults.resonance\n            .value);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.MoogFilter.prototype = Object.create(Super, {\n        name: {\n            value: \"MoogFilter\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                bufferSize: {\n                    value: 4096,\n                    min: 256,\n                    max: 16384,\n                    automatable: false,\n                    type: INT\n                },\n                bypass: {\n                    value: false,\n                    automatable: false,\n                    type: BOOLEAN\n                },\n                cutoff: {\n                    value: 0.065,\n                    min: 0.0001,\n                    max: 1.0,\n                    automatable: false,\n                    type: FLOAT\n                },\n                resonance: {\n                    value: 3.5,\n                    min: 0.0,\n                    max: 4.0,\n                    automatable: false,\n                    type: FLOAT\n                }\n            }\n        },\n        cutoff: {\n            enumerable: true,\n            get: function() {\n                return this.processor.cutoff;\n            },\n            set: function(value) {\n                this.processor.cutoff = value;\n            }\n        },\n        resonance: {\n            enumerable: true,\n            get: function() {\n                return this.processor.resonance;\n            },\n            set: function(value) {\n                this.processor.resonance = value;\n            }\n        }\n    });\n\n    Tuna.prototype.Overdrive = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.activateNode = userContext.createGain();\n        this.inputDrive = userContext.createGain();\n        this.waveshaper = userContext.createWaveShaper();\n        this.outputDrive = userContext.createGain();\n        this.output = userContext.createGain();\n\n        this.activateNode.connect(this.inputDrive);\n        this.inputDrive.connect(this.waveshaper);\n        this.waveshaper.connect(this.outputDrive);\n        this.outputDrive.connect(this.output);\n\n        this.ws_table = new Float32Array(this.k_nSamples);\n        this.drive = initValue(properties.drive, this.defaults.drive.value);\n        this.outputGain = initValue(properties.outputGain, this.defaults\n            .outputGain\n            .value);\n        this.curveAmount = initValue(properties.curveAmount, this.defaults\n            .curveAmount\n            .value);\n        this.algorithmIndex = initValue(properties.algorithmIndex, this\n            .defaults\n            .algorithmIndex.value);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Overdrive.prototype = Object.create(Super, {\n        name: {\n            value: \"Overdrive\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                drive: {\n                    value: 1,\n                    min: 0,\n                    max: 1,\n                    automatable: true,\n                    type: FLOAT,\n                    scaled: true\n                },\n                outputGain: {\n                    value: 1,\n                    min: 0,\n                    max: 1,\n                    automatable: true,\n                    type: FLOAT,\n                    scaled: true\n                },\n                curveAmount: {\n                    value: 0.725,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                algorithmIndex: {\n                    value: 0,\n                    min: 0,\n                    max: 5,\n                    automatable: false,\n                    type: INT\n                }\n            }\n        },\n        k_nSamples: {\n            value: 8192\n        },\n        drive: {\n            get: function() {\n                return this.inputDrive.gain;\n            },\n            set: function(value) {\n                this._drive = value;\n            }\n        },\n        curveAmount: {\n            get: function() {\n                return this._curveAmount;\n            },\n            set: function(value) {\n                this._curveAmount = value;\n                if (this._algorithmIndex === undefined) {\n                    this._algorithmIndex = 0;\n                }\n                this.waveshaperAlgorithms[this._algorithmIndex]\n                    (this._curveAmount,\n                        this.k_nSamples, this.ws_table);\n                this.waveshaper.curve = this.ws_table;\n            }\n        },\n        outputGain: {\n            get: function() {\n                return this.outputDrive.gain;\n            },\n            set: function(value) {\n                this._outputGain = dbToWAVolume(value);\n            }\n        },\n        algorithmIndex: {\n            get: function() {\n                return this._algorithmIndex;\n            },\n            set: function(value) {\n                this._algorithmIndex = value;\n                this.curveAmount = this._curveAmount;\n            }\n        },\n        waveshaperAlgorithms: {\n            value: [\n                function(amount, n_samples, ws_table) {\n                    amount = Math.min(amount, 0.9999);\n                    var k = 2 * amount / (1 - amount),\n                        i, x;\n                    for (i = 0; i < n_samples; i++) {\n                        x = i * 2 / n_samples - 1;\n                        ws_table[i] = (1 + k) * x / (1 + k * Math.abs(x));\n                    }\n                },\n                function(amount, n_samples, ws_table) {\n                    var i, x, y;\n                    for (i = 0; i < n_samples; i++) {\n                        x = i * 2 / n_samples - 1;\n                        y = ((0.5 * Math.pow((x + 1.4), 2)) - 1) * y >= 0 ? 5.8 : 1.2;\n                        ws_table[i] = tanh(y);\n                    }\n                },\n                function(amount, n_samples, ws_table) {\n                    var i, x, y, a = 1 - amount;\n                    for (i = 0; i < n_samples; i++) {\n                        x = i * 2 / n_samples - 1;\n                        y = x < 0 ? -Math.pow(Math.abs(x), a + 0.04) : Math.pow(x, a);\n                        ws_table[i] = tanh(y * 2);\n                    }\n                },\n                function(amount, n_samples, ws_table) {\n                    var i, x, y, abx, a = 1 - amount > 0.99 ? 0.99 : 1 - amount;\n                    for (i = 0; i < n_samples; i++) {\n                        x = i * 2 / n_samples - 1;\n                        abx = Math.abs(x);\n                        if (abx < a) y = abx;\n                        else if (abx > a) y = a + (abx - a) / (1 + Math.pow((abx - a) / (1 - a), 2));\n                        else if (abx > 1) y = abx;\n                        ws_table[i] = sign(x) * y * (1 / ((a + 1) / 2));\n                    }\n                },\n                function(amount, n_samples, ws_table) { // fixed curve, amount doesn't do anything, the distortion is just from the drive\n                    var i, x;\n                    for (i = 0; i < n_samples; i++) {\n                        x = i * 2 / n_samples - 1;\n                        if (x < -0.08905) {\n                            ws_table[i] = (-3 / 4) * (1 - (Math.pow((1 - (Math.abs(x) - 0.032857)), 12)) + (1 / 3) * (Math.abs(x) -\n                                0.032847)) + 0.01;\n                        } else if (x >= -0.08905 && x < 0.320018) {\n                            ws_table[i] = (-6.153 * (x * x)) + 3.9375 * x;\n                        } else {\n                            ws_table[i] = 0.630035;\n                        }\n                    }\n                },\n                function(amount, n_samples, ws_table) {\n                    var a = 2 + Math.round(amount * 14),\n                        // we go from 2 to 16 bits, keep in mind for the UI\n                        bits = Math.round(Math.pow(2, a - 1)),\n                        // real number of quantization steps divided by 2\n                        i, x;\n                    for (i = 0; i < n_samples; i++) {\n                        x = i * 2 / n_samples - 1;\n                        ws_table[i] = Math.round(x * bits) / bits;\n                    }\n                }\n            ]\n        }\n    });\n\n    Tuna.prototype.Phaser = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.splitter = this.activateNode = userContext.createChannelSplitter(2);\n        this.filtersL = [];\n        this.filtersR = [];\n        this.feedbackGainNodeL = userContext.createGain();\n        this.feedbackGainNodeR = userContext.createGain();\n        this.merger = userContext.createChannelMerger(2);\n        this.filteredSignal = userContext.createGain();\n        this.output = userContext.createGain();\n        this.lfoL = new userInstance.LFO({\n            target: this.filtersL,\n            callback: this.callback\n        });\n        this.lfoR = new userInstance.LFO({\n            target: this.filtersR,\n            callback: this.callback\n        });\n\n        var i = this.stage;\n        while (i--) {\n            this.filtersL[i] = userContext.createBiquadFilter();\n            this.filtersR[i] = userContext.createBiquadFilter();\n            this.filtersL[i].type = \"allpass\";\n            this.filtersR[i].type = \"allpass\";\n        }\n        this.input.connect(this.splitter);\n        this.input.connect(this.output);\n        this.splitter.connect(this.filtersL[0], 0, 0);\n        this.splitter.connect(this.filtersR[0], 1, 0);\n        this.connectInOrder(this.filtersL);\n        this.connectInOrder(this.filtersR);\n        this.filtersL[this.stage - 1].connect(this.feedbackGainNodeL);\n        this.filtersL[this.stage - 1].connect(this.merger, 0, 0);\n        this.filtersR[this.stage - 1].connect(this.feedbackGainNodeR);\n        this.filtersR[this.stage - 1].connect(this.merger, 0, 1);\n        this.feedbackGainNodeL.connect(this.filtersL[0]);\n        this.feedbackGainNodeR.connect(this.filtersR[0]);\n        this.merger.connect(this.output);\n\n        this.rate = initValue(properties.rate, this.defaults.rate.value);\n        this.baseModulationFrequency = properties.baseModulationFrequency || this.defaults.baseModulationFrequency.value;\n        this.depth = initValue(properties.depth, this.defaults.depth.value);\n        this.feedback = initValue(properties.feedback, this.defaults.feedback.value);\n        this.stereoPhase = initValue(properties.stereoPhase, this.defaults.stereoPhase.value);\n\n        this.lfoL.activate(true);\n        this.lfoR.activate(true);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Phaser.prototype = Object.create(Super, {\n        name: {\n            value: \"Phaser\"\n        },\n        stage: {\n            value: 4\n        },\n        defaults: {\n            writable: true,\n            value: {\n                rate: {\n                    value: 0.1,\n                    min: 0,\n                    max: 8,\n                    automatable: false,\n                    type: FLOAT\n                },\n                depth: {\n                    value: 0.6,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                feedback: {\n                    value: 0.7,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                stereoPhase: {\n                    value: 40,\n                    min: 0,\n                    max: 180,\n                    automatable: false,\n                    type: FLOAT\n                },\n                baseModulationFrequency: {\n                    value: 700,\n                    min: 500,\n                    max: 1500,\n                    automatable: false,\n                    type: FLOAT\n                }\n            }\n        },\n        callback: {\n            value: function(filters, value) {\n                for (var stage = 0; stage < 4; stage++) {\n                    filters[stage].frequency.value = value;\n                }\n            }\n        },\n        depth: {\n            get: function() {\n                return this._depth;\n            },\n            set: function(value) {\n                this._depth = value;\n                this.lfoL.oscillation = this._baseModulationFrequency * this._depth;\n                this.lfoR.oscillation = this._baseModulationFrequency * this._depth;\n            }\n        },\n        rate: {\n            get: function() {\n                return this._rate;\n            },\n            set: function(value) {\n                this._rate = value;\n                this.lfoL.frequency = this._rate;\n                this.lfoR.frequency = this._rate;\n            }\n        },\n        baseModulationFrequency: {\n            enumerable: true,\n            get: function() {\n                return this._baseModulationFrequency;\n            },\n            set: function(value) {\n                this._baseModulationFrequency = value;\n                this.lfoL.offset = this._baseModulationFrequency;\n                this.lfoR.offset = this._baseModulationFrequency;\n                this._depth = this._depth;\n            }\n        },\n        feedback: {\n            get: function() {\n                return this._feedback;\n            },\n            set: function(value) {\n                this._feedback = value;\n                this.feedbackGainNodeL.gain.value = this._feedback;\n                this.feedbackGainNodeR.gain.value = this._feedback;\n            }\n        },\n        stereoPhase: {\n            get: function() {\n                return this._stereoPhase;\n            },\n            set: function(value) {\n                this._stereoPhase = value;\n                var newPhase = this.lfoL._phase + this._stereoPhase *\n                    Math.PI /\n                    180;\n                newPhase = fmod(newPhase, 2 * Math.PI);\n                this.lfoR._phase = newPhase;\n            }\n        }\n    });\n\n    Tuna.prototype.PingPongDelay = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.wetLevel = userContext.createGain();\n        this.stereoToMonoMix = userContext.createGain();\n        this.feedbackLevel = userContext.createGain();\n        this.output = userContext.createGain();\n        this.delayLeft = userContext.createDelay();\n        this.delayRight = userContext.createDelay();\n\n        this.activateNode = userContext.createGain();\n        this.splitter = userContext.createChannelSplitter(2);\n        this.merger = userContext.createChannelMerger(2);\n\n        this.activateNode.connect(this.splitter);\n        this.splitter.connect(this.stereoToMonoMix, 0, 0);\n        this.splitter.connect(this.stereoToMonoMix, 1, 0);\n        this.stereoToMonoMix.gain.value = .5;\n        this.stereoToMonoMix.connect(this.wetLevel);\n        this.wetLevel.connect(this.delayLeft);\n        this.feedbackLevel.connect(this.delayLeft);\n        this.delayLeft.connect(this.delayRight);\n        this.delayRight.connect(this.feedbackLevel);\n        this.delayLeft.connect(this.merger, 0, 0);\n        this.delayRight.connect(this.merger, 0, 1);\n        this.merger.connect(this.output);\n        this.activateNode.connect(this.output);\n\n        this.delayTimeLeft = properties.delayTimeLeft !== undefined ? properties.delayTimeLeft : this.defaults.delayTimeLeft.value;\n        this.delayTimeRight = properties.delayTimeRight !== undefined ? properties.delayTimeRight : this.defaults.delayTimeRight.value;\n        this.feedbackLevel.gain.value = properties.feedback !== undefined ? properties.feedback : this.defaults.feedback.value;\n        this.wetLevel.gain.value = properties.wetLevel !== undefined ? properties.wetLevel : this.defaults.wetLevel.value;\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.PingPongDelay.prototype = Object.create(Super, {\n        name: {\n            value: \"PingPongDelay\"\n        },\n        delayTimeLeft: {\n            enumerable: true,\n            get: function() {\n                return this._delayTimeLeft;\n            },\n            set: function(value) {\n                this._delayTimeLeft = value;\n                this.delayLeft.delayTime.value = value / 1000;\n            }\n        },\n        delayTimeRight: {\n            enumerable: true,\n            get: function() {\n                return this._delayTimeRight;\n            },\n            set: function(value) {\n                this._delayTimeRight = value;\n                this.delayRight.delayTime.value = value / 1000;\n            }\n        },\n        defaults: {\n            writable: true,\n            value: {\n                delayTimeLeft: {\n                    value: 200,\n                    min: 1,\n                    max: 10000,\n                    automatable: false,\n                    type: INT\n                },\n                delayTimeRight: {\n                    value: 400,\n                    min: 1,\n                    max: 10000,\n                    automatable: false,\n                    type: INT\n                },\n                feedback: {\n                    value: 0.3,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                wetLevel: {\n                    value: 0.5,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                }\n            }\n        }\n    });\n\n    Tuna.prototype.Tremolo = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.splitter = this.activateNode = userContext.createChannelSplitter(\n                2),\n            this.amplitudeL = userContext.createGain(), this.amplitudeR =\n            userContext.createGain(), this.merger = userContext.createChannelMerger(\n                2), this.output = userContext.createGain();\n        this.lfoL = new userInstance.LFO({\n            target: this.amplitudeL.gain,\n            callback: pipe\n        });\n        this.lfoR = new userInstance.LFO({\n            target: this.amplitudeR.gain,\n            callback: pipe\n        });\n\n        this.input.connect(this.splitter);\n        this.splitter.connect(this.amplitudeL, 0);\n        this.splitter.connect(this.amplitudeR, 1);\n        this.amplitudeL.connect(this.merger, 0, 0);\n        this.amplitudeR.connect(this.merger, 0, 1);\n        this.merger.connect(this.output);\n\n        this.rate = properties.rate || this.defaults.rate.value;\n        this.intensity = initValue(properties.intensity, this.defaults.intensity\n            .value);\n        this.stereoPhase = initValue(properties.stereoPhase, this.defaults\n            .stereoPhase\n            .value);\n\n        this.lfoL.offset = 1 - (this.intensity / 2);\n        this.lfoR.offset = 1 - (this.intensity / 2);\n        this.lfoL.phase = this.stereoPhase * Math.PI / 180;\n\n        this.lfoL.activate(true);\n        this.lfoR.activate(true);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.Tremolo.prototype = Object.create(Super, {\n        name: {\n            value: \"Tremolo\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                intensity: {\n                    value: 0.3,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                stereoPhase: {\n                    value: 0,\n                    min: 0,\n                    max: 180,\n                    automatable: false,\n                    type: FLOAT\n                },\n                rate: {\n                    value: 5,\n                    min: 0.1,\n                    max: 11,\n                    automatable: false,\n                    type: FLOAT\n                }\n            }\n        },\n        intensity: {\n            enumerable: true,\n            get: function() {\n                return this._intensity;\n            },\n            set: function(value) {\n                this._intensity = value;\n                this.lfoL.offset = 1 - this._intensity / 2;\n                this.lfoR.offset = 1 - this._intensity / 2;\n                this.lfoL.oscillation = this._intensity;\n                this.lfoR.oscillation = this._intensity;\n            }\n        },\n        rate: {\n            enumerable: true,\n            get: function() {\n                return this._rate;\n            },\n            set: function(value) {\n                this._rate = value;\n                this.lfoL.frequency = this._rate;\n                this.lfoR.frequency = this._rate;\n            }\n        },\n        stereoPhase: {\n            enumerable: true,\n            get: function() {\n                return this._rate;\n            },\n            set: function(value) {\n                this._stereoPhase = value;\n                var newPhase = this.lfoL._phase + this._stereoPhase *\n                    Math.PI /\n                    180;\n                newPhase = fmod(newPhase, 2 * Math.PI);\n                this.lfoR.phase = newPhase;\n            }\n        }\n    });\n\n    Tuna.prototype.WahWah = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.activateNode = userContext.createGain();\n        this.envelopeFollower = new userInstance.EnvelopeFollower({\n            target: this,\n            callback: function(context, value) {\n                context.sweep = value;\n            }\n        });\n        this.filterBp = userContext.createBiquadFilter();\n        this.filterPeaking = userContext.createBiquadFilter();\n        this.output = userContext.createGain();\n\n        //Connect AudioNodes\n        this.activateNode.connect(this.filterBp);\n        this.filterBp.connect(this.filterPeaking);\n        this.filterPeaking.connect(this.output);\n\n        //Set Properties\n        this.init();\n        this.automode = initValue(properties.enableAutoMode, this.defaults\n            .automode\n            .value);\n        this.resonance = properties.resonance || this.defaults.resonance\n            .value;\n        this.sensitivity = initValue(properties.sensitivity, this.defaults\n            .sensitivity\n            .value);\n        this.baseFrequency = initValue(properties.baseFrequency, this.defaults\n            .baseFrequency\n            .value);\n        this.excursionOctaves = properties.excursionOctaves || this.defaults\n            .excursionOctaves\n            .value;\n        this.sweep = initValue(properties.sweep, this.defaults.sweep.value);\n\n        this.activateNode.gain.value = 2;\n        this.envelopeFollower.activate(true);\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.WahWah.prototype = Object.create(Super, {\n        name: {\n            value: \"WahWah\"\n        },\n        defaults: {\n            writable: true,\n            value: {\n                automode: {\n                    value: true,\n                    automatable: false,\n                    type: BOOLEAN\n                },\n                baseFrequency: {\n                    value: 0.5,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                excursionOctaves: {\n                    value: 2,\n                    min: 1,\n                    max: 6,\n                    automatable: false,\n                    type: FLOAT\n                },\n                sweep: {\n                    value: 0.2,\n                    min: 0,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                },\n                resonance: {\n                    value: 10,\n                    min: 1,\n                    max: 100,\n                    automatable: false,\n                    type: FLOAT\n                },\n                sensitivity: {\n                    value: 0.5,\n                    min: -1,\n                    max: 1,\n                    automatable: false,\n                    type: FLOAT\n                }\n            }\n        },\n        activateCallback: {\n            value: function(value) {\n                this.automode = value;\n            }\n        },\n        automode: {\n            get: function() {\n                return this._automode;\n            },\n            set: function(value) {\n                this._automode = value;\n                if (value) {\n                    this.activateNode.connect(this.envelopeFollower.input);\n                    this.envelopeFollower.activate(true);\n                } else {\n                    this.envelopeFollower.activate(false);\n                    this.activateNode.disconnect();\n                    this.activateNode.connect(this.filterBp);\n                }\n            }\n        },\n        filterFreqTimeout: {\n            value: 0\n        },\n        setFilterFreq: {\n            value: function() {\n                try {\n                    this.filterBp.frequency.value = this._baseFrequency + this._excursionFrequency * this._sweep;\n                    this.filterPeaking.frequency.value = this._baseFrequency + this._excursionFrequency * this._sweep;\n                } catch (e) {\n                    clearTimeout(this.filterFreqTimeout);\n                    //put on the next cycle to let all init properties be set\n                    this.filterFreqTimeout = setTimeout(function() {\n                        this.setFilterFreq();\n                    }.bind(this), 0);\n                }\n            }\n        },\n        sweep: {\n            enumerable: true,\n            get: function() {\n                return this._sweep.value;\n            },\n            set: function(value) {\n                this._sweep = Math.pow(value > 1 ? 1 : value <\n                    0 ? 0 :\n                    value,\n                    this._sensitivity);\n                this.setFilterFreq();\n            }\n        },\n        baseFrequency: {\n            enumerable: true,\n            get: function() {\n                return this._baseFrequency;\n            },\n            set: function(value) {\n                this._baseFrequency = 50 * Math.pow(10, value *\n                    2);\n                this._excursionFrequency = Math.min(userContext\n                    .sampleRate /\n                    2,\n                    this.baseFrequency * Math.pow(2, this._excursionOctaves)\n                );\n                this.setFilterFreq();\n            }\n        },\n        excursionOctaves: {\n            enumerable: true,\n            get: function() {\n                return this._excursionOctaves;\n            },\n            set: function(value) {\n                this._excursionOctaves = value;\n                this._excursionFrequency = Math.min(userContext\n                    .sampleRate /\n                    2,\n                    this.baseFrequency * Math.pow(2, this._excursionOctaves)\n                );\n                this.setFilterFreq();\n            }\n        },\n        sensitivity: {\n            enumerable: true,\n            get: function() {\n                return this._sensitivity;\n            },\n            set: function(value) {\n                this._sensitivity = Math.pow(10, value);\n            }\n        },\n        resonance: {\n            enumerable: true,\n            get: function() {\n                return this._resonance;\n            },\n            set: function(value) {\n                this._resonance = value;\n                this.filterPeaking.Q = this._resonance;\n            }\n        },\n        init: {\n            value: function() {\n                this.output.gain.value = 1;\n                this.filterPeaking.type = \"peaking\";\n                this.filterBp.type = \"bandpass\";\n                this.filterPeaking.frequency.value = 100;\n                this.filterPeaking.gain.value = 20;\n                this.filterPeaking.Q.value = 5;\n                this.filterBp.frequency.value = 100;\n                this.filterBp.Q.value = 1;\n            }\n        }\n    });\n\n    Tuna.prototype.EnvelopeFollower = function(properties) {\n        if (!properties) {\n            properties = this.getDefaults();\n        }\n        this.input = userContext.createGain();\n        this.jsNode = this.output = userContext.createScriptProcessor(\n            this.buffersize,\n            1, 1);\n\n        this.input.connect(this.output);\n\n        this.attackTime = initValue(properties.attackTime, this.defaults\n            .attackTime\n            .value);\n        this.releaseTime = initValue(properties.releaseTime, this.defaults\n            .releaseTime\n            .value);\n        this._envelope = 0;\n        this.target = properties.target || {};\n        this.callback = properties.callback || function() {};\n    };\n    Tuna.prototype.EnvelopeFollower.prototype = Object.create(Super, {\n        name: {\n            value: \"EnvelopeFollower\"\n        },\n        defaults: {\n            value: {\n                attackTime: {\n                    value: 0.003,\n                    min: 0,\n                    max: 0.5,\n                    automatable: false,\n                    type: FLOAT\n                },\n                releaseTime: {\n                    value: 0.5,\n                    min: 0,\n                    max: 0.5,\n                    automatable: false,\n                    type: FLOAT\n                }\n            }\n        },\n        buffersize: {\n            value: 256\n        },\n        envelope: {\n            value: 0\n        },\n        sampleRate: {\n            value: 44100\n        },\n        attackTime: {\n            enumerable: true,\n            get: function() {\n                return this._attackTime;\n            },\n            set: function(value) {\n                this._attackTime = value;\n                this._attackC = Math.exp(-1 / this._attackTime *\n                    this.sampleRate /\n                    this.buffersize);\n            }\n        },\n        releaseTime: {\n            enumerable: true,\n            get: function() {\n                return this._releaseTime;\n            },\n            set: function(value) {\n                this._releaseTime = value;\n                this._releaseC = Math.exp(-1 / this._releaseTime *\n                    this.sampleRate /\n                    this.buffersize);\n            }\n        },\n        callback: {\n            get: function() {\n                return this._callback;\n            },\n            set: function(value) {\n                if (typeof value === \"function\") {\n                    this._callback = value;\n                } else {\n                    console.error(\"tuna.js: \" + this.name +\n                        \": Callback must be a function!\");\n                }\n            }\n        },\n        target: {\n            get: function() {\n                return this._target;\n            },\n            set: function(value) {\n                this._target = value;\n            }\n        },\n        activate: {\n            value: function(doActivate) {\n                this.activated = doActivate;\n                if (doActivate) {\n                    this.jsNode.connect(userContext.destination);\n                    this.jsNode.onaudioprocess = this.returnCompute(\n                        this);\n                } else {\n                    this.jsNode.disconnect();\n                    this.jsNode.onaudioprocess = null;\n                }\n            }\n        },\n        returnCompute: {\n            value: function(instance) {\n                return function(event) {\n                    instance.compute(event);\n                };\n            }\n        },\n        compute: {\n            value: function(event) {\n                var count = event.inputBuffer.getChannelData(0)\n                    .length,\n                    channels = event.inputBuffer.numberOfChannels,\n                    current, chan, rms, i;\n                chan = rms = i = 0;\n                if (channels > 1) { //need to mixdown\n                    for (i = 0; i < count; ++i) {\n                        for (; chan < channels; ++chan) {\n                            current = event.inputBuffer.getChannelData(chan)[i];\n                            rms += (current * current) / channels;\n                        }\n                    }\n                } else {\n                    for (i = 0; i < count; ++i) {\n                        current = event.inputBuffer.getChannelData(0)[i];\n                        rms += (current * current);\n                    }\n                }\n                rms = Math.sqrt(rms);\n\n                if (this._envelope < rms) {\n                    this._envelope *= this._attackC;\n                    this._envelope += (1 - this._attackC) * rms;\n                } else {\n                    this._envelope *= this._releaseC;\n                    this._envelope += (1 - this._releaseC) *\n                        rms;\n                }\n                this._callback(this._target, this._envelope);\n            }\n        }\n    });\n\n    Tuna.prototype.LFO = function(properties) {\n        //Instantiate AudioNode\n        this.output = userContext.createScriptProcessor(256, 1, 1);\n        this.activateNode = userContext.destination;\n\n        //Set Properties\n        this.frequency = initValue(properties.frequency, this.defaults.frequency\n            .value);\n        this.offset = initValue(properties.offset, this.defaults.offset.value);\n        this.oscillation = initValue(properties.oscillation, this.defaults\n            .oscillation\n            .value);\n        this.phase = initValue(properties.phase, this.defaults.phase.value);\n        this.target = properties.target || {};\n        this.output.onaudioprocess = this.callback(properties.callback ||\n            function() {});\n        this.bypass = properties.bypass || false;\n    };\n    Tuna.prototype.LFO.prototype = Object.create(Super, {\n        name: {\n            value: \"LFO\"\n        },\n        bufferSize: {\n            value: 256\n        },\n        sampleRate: {\n            value: 44100\n        },\n        defaults: {\n            value: {\n                frequency: {\n                    value: 1,\n                    min: 0,\n                    max: 20,\n                    automatable: false,\n                    type: FLOAT\n                },\n                offset: {\n                    value: 0.85,\n                    min: 0,\n                    max: 22049,\n                    automatable: false,\n                    type: FLOAT\n                },\n                oscillation: {\n                    value: 0.3,\n                    min: -22050,\n                    max: 22050,\n                    automatable: false,\n                    type: FLOAT\n                },\n                phase: {\n                    value: 0,\n                    min: 0,\n                    max: 2 * Math.PI,\n                    automatable: false,\n                    type: FLOAT\n                }\n            }\n        },\n        frequency: {\n            get: function() {\n                return this._frequency;\n            },\n            set: function(value) {\n                this._frequency = value;\n                this._phaseInc = 2 * Math.PI * this._frequency *\n                    this.bufferSize /\n                    this.sampleRate;\n            }\n        },\n        offset: {\n            get: function() {\n                return this._offset;\n            },\n            set: function(value) {\n                this._offset = value;\n            }\n        },\n        oscillation: {\n            get: function() {\n                return this._oscillation;\n            },\n            set: function(value) {\n                this._oscillation = value;\n            }\n        },\n        phase: {\n            get: function() {\n                return this._phase;\n            },\n            set: function(value) {\n                this._phase = value;\n            }\n        },\n        target: {\n            get: function() {\n                return this._target;\n            },\n            set: function(value) {\n                this._target = value;\n            }\n        },\n        activate: {\n            value: function(doActivate) {\n                if (!doActivate) {\n                    this.output.disconnect(userContext.destination);\n                } else {\n                    this.output.connect(userContext.destination);\n                }\n            }\n        },\n        callback: {\n            value: function(callback) {\n                var that = this;\n                return function() {\n                    that._phase += that._phaseInc;\n                    if (that._phase > 2 * Math.PI) {\n                        that._phase = 0;\n                    }\n                    callback(that._target, that._offset +\n                        that._oscillation *\n                        Math.sin(that._phase));\n                };\n            }\n        }\n    });\n\n    Tuna.toString = Tuna.prototype.toString = function() {\n        return \"Please visit https://github.com/Theodeus/tuna/wiki for instructions on how to use Tuna.js\";\n    };\n})(this);\n","/**\n * @license -------------------------------------------------------------------\n *   module: Base64Binary\n *      src: http://blog.danguer.com/2011/10/24/base64-binary-decoding-in-javascript/\n *  license: Simplified BSD License\n * -------------------------------------------------------------------\n * Copyright 2011, Daniel Guerrero. All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     - Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     - Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL DANIEL GUERRERO BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nmodule.exports = {\n\t_keyStr : \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n\n\t/* will return a  Uint8Array type */\n\tdecodeArrayBuffer: function(input) {\n\t\tvar bytes = Math.ceil( (3*input.length) / 4.0);\n\t\tvar ab = new ArrayBuffer(bytes);\n\t\tthis.decode(input, ab);\n\n\t\treturn ab;\n\t},\n\n\tdecode: function(input, arrayBuffer) {\n\t\t//get last chars to see if are valid\n\t\tvar lkey1 = this._keyStr.indexOf(input.charAt(input.length-1));\t\t \n\t\tvar lkey2 = this._keyStr.indexOf(input.charAt(input.length-1));\t\t \n\n\t\tvar bytes = Math.ceil( (3*input.length) / 4.0);\n\t\tif (lkey1 == 64) bytes--; //padding chars, so skip\n\t\tif (lkey2 == 64) bytes--; //padding chars, so skip\n\n\t\tvar uarray;\n\t\tvar chr1, chr2, chr3;\n\t\tvar enc1, enc2, enc3, enc4;\n\t\tvar i = 0;\n\t\tvar j = 0;\n\n\t\tif (arrayBuffer)\n\t\t\tuarray = new Uint8Array(arrayBuffer);\n\t\telse\n\t\t\tuarray = new Uint8Array(bytes);\n\n\t\tinput = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n\t\tfor (i=0; i<bytes; i+=3) {\t\n\t\t\t//get the 3 octects in 4 ascii chars\n\t\t\tenc1 = this._keyStr.indexOf(input.charAt(j++));\n\t\t\tenc2 = this._keyStr.indexOf(input.charAt(j++));\n\t\t\tenc3 = this._keyStr.indexOf(input.charAt(j++));\n\t\t\tenc4 = this._keyStr.indexOf(input.charAt(j++));\n\n\t\t\tchr1 = (enc1 << 2) | (enc2 >> 4);\n\t\t\tchr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n\t\t\tchr3 = ((enc3 & 3) << 6) | enc4;\n\n\t\t\tuarray[i] = chr1;\t\t\t\n\t\t\tif (enc3 != 64) uarray[i+1] = chr2;\n\t\t\tif (enc4 != 64) uarray[i+2] = chr3;\n\t\t}\n\n\t\treturn uarray;\t\n\t}\n};","/* Copyright 2013 Chris Wilson\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n*/\n\n// Initialize the MIDI library.\n(function (global) {\n    'use strict';\n    var midiIO, _requestMIDIAccess, MIDIAccess, _onReady, MIDIPort, MIDIInput, MIDIOutput, _midiProc;\n\n    function Promise() {\n\n    }\n\n    Promise.prototype.then = function(accept, reject) {\n        this.accept = accept; \n        this.reject = reject;\n    }\n\n    Promise.prototype.succeed = function(access) {\n        if (this.accept)\n            this.accept(access);\n    }\n\n    Promise.prototype.fail = function(error) {\n        if (this.reject)\n            this.reject(error);\n    }\n\n    function _JazzInstance() {\n        this.inputInUse = false;\n        this.outputInUse = false;\n\n        // load the Jazz plugin\n        var o1 = document.createElement(\"object\");\n        o1.id = \"_Jazz\" + Math.random() + \"ie\";\n        o1.classid = \"CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90\";\n\n        this.activeX = o1;\n\n        var o2 = document.createElement(\"object\");\n        o2.id = \"_Jazz\" + Math.random();\n        o2.type=\"audio/x-jazz\";\n        o1.appendChild(o2);\n\n        this.objRef = o2;\n\n        var e = document.createElement(\"p\");\n        e.appendChild(document.createTextNode(\"This page requires the \"));\n\n        var a = document.createElement(\"a\");\n        a.appendChild(document.createTextNode(\"Jazz plugin\"));\n        a.href = \"http://jazz-soft.net/\";\n\n        e.appendChild(a);\n        e.appendChild(document.createTextNode(\".\"));\n        o2.appendChild(e);\n\n        var insertionPoint = document.getElementById(\"MIDIPlugin\");\n        if (!insertionPoint) {\n            // Create hidden element\n            var insertionPoint = document.createElement(\"div\");\n            insertionPoint.id = \"MIDIPlugin\";\n            insertionPoint.style.position = \"absolute\";\n            insertionPoint.style.visibility = \"hidden\";\n            insertionPoint.style.left = \"-9999px\";\n            insertionPoint.style.top = \"-9999px\";\n            document.body.appendChild(insertionPoint);\n        }\n        insertionPoint.appendChild(o1);\n\n        if (this.objRef.isJazz)\n            this._Jazz = this.objRef;\n        else if (this.activeX.isJazz)\n            this._Jazz = this.activeX;\n        else\n            this._Jazz = null;\n        if (this._Jazz) {\n            this._Jazz._jazzTimeZero = this._Jazz.Time();\n            this._Jazz._perfTimeZero = window.performance.now();\n        }\n    }\n\n    _requestMIDIAccess = function _requestMIDIAccess() {\n        var access = new MIDIAccess();\n        return access._promise;\n    };\n\n    // API Methods\n\n    MIDIAccess = function() {\n        this._jazzInstances = new Array();\n        this._jazzInstances.push( new _JazzInstance() );\n        this._promise = new Promise;\n\n        if (this._jazzInstances[0]._Jazz) {\n            this._Jazz = this._jazzInstances[0]._Jazz;\n            window.setTimeout( _onReady.bind(this), 3 );\n        } else {\n            window.setTimeout( _onNotReady.bind(this), 3 );\n        }\n    };\n\n    _onReady = function _onReady() {\n        if (this._promise)\n            this._promise.succeed(this);\n    };\n\n    function _onNotReady() {\n        if (this._promise)\n            this._promise.fail( { code: 1 } );\n    };\n\n    MIDIAccess.prototype.inputs = function(  ) {\n        if (!this._Jazz)\n              return null;\n        var list=this._Jazz.MidiInList();\n        var inputs = new Array( list.length );\n\n        for ( var i=0; i<list.length; i++ ) {\n            inputs[i] = new MIDIInput( this, list[i], i );\n        }\n        return inputs;\n    }\n\n    MIDIAccess.prototype.outputs = function(  ) {\n        if (!this._Jazz)\n            return null;\n        var list=this._Jazz.MidiOutList();\n        var outputs = new Array( list.length );\n\n        for ( var i=0; i<list.length; i++ ) {\n            outputs[i] = new MIDIOutput( this, list[i], i );\n        }\n        return outputs;\n    };\n\n    MIDIInput = function MIDIInput( midiAccess, name, index ) {\n        this._listeners = [];\n        this._midiAccess = midiAccess;\n        this._index = index;\n        this._inLongSysexMessage = false;\n        this._sysexBuffer = new Uint8Array();\n        this.id = \"\" + index + \".\" + name;\n        this.manufacturer = \"\";\n        this.name = name;\n        this.type = \"input\";\n        this.version = \"\";\n        this.onmidimessage = null;\n\n        var inputInstance = null;\n        for (var i=0; (i<midiAccess._jazzInstances.length)&&(!inputInstance); i++) {\n            if (!midiAccess._jazzInstances[i].inputInUse)\n                inputInstance=midiAccess._jazzInstances[i];\n        }\n        if (!inputInstance) {\n            inputInstance = new _JazzInstance();\n            midiAccess._jazzInstances.push( inputInstance );\n        }\n        inputInstance.inputInUse = true;\n\n        this._jazzInstance = inputInstance._Jazz;\n        this._input = this._jazzInstance.MidiInOpen( this._index, _midiProc.bind(this) );\n    };\n\n    // Introduced in DOM Level 2:\n    MIDIInput.prototype.addEventListener = function (type, listener, useCapture ) {\n        if (type !== \"midimessage\")\n            return;\n        for (var i=0; i<this._listeners.length; i++)\n            if (this._listeners[i] == listener)\n                return;\n        this._listeners.push( listener );\n    };\n\n    MIDIInput.prototype.removeEventListener = function (type, listener, useCapture ) {\n        if (type !== \"midimessage\")\n            return;\n        for (var i=0; i<this._listeners.length; i++)\n            if (this._listeners[i] == listener) {\n                this._listeners.splice( i, 1 );  //remove it\n                return;\n            }\n    };\n\n    MIDIInput.prototype.preventDefault = function() {\n        this._pvtDef = true;\n    };\n\n    MIDIInput.prototype.dispatchEvent = function (evt) {\n        this._pvtDef = false;\n\n        // dispatch to listeners\n        for (var i=0; i<this._listeners.length; i++)\n            if (this._listeners[i].handleEvent)\n                this._listeners[i].handleEvent.bind(this)( evt );\n            else\n                this._listeners[i].bind(this)( evt );\n\n        if (this.onmidimessage)\n            this.onmidimessage( evt );\n\n        return this._pvtDef;\n    };\n\n    MIDIInput.prototype.appendToSysexBuffer = function ( data ) {\n        var oldLength = this._sysexBuffer.length;\n        var tmpBuffer = new Uint8Array( oldLength + data.length );\n        tmpBuffer.set( this._sysexBuffer );\n        tmpBuffer.set( data, oldLength );\n        this._sysexBuffer = tmpBuffer;\n    };\n\n    MIDIInput.prototype.bufferLongSysex = function ( data, initialOffset ) {\n        var j = initialOffset;\n        while (j<data.length) {\n            if (data[j] == 0xF7) {\n                // end of sysex!\n                j++;\n                this.appendToSysexBuffer( data.slice(initialOffset, j) );\n                return j;\n            }\n            j++;\n        }\n        // didn't reach the end; just tack it on.\n        this.appendToSysexBuffer( data.slice(initialOffset, j) );\n        this._inLongSysexMessage = true;\n        return j;\n    };\n\n    _midiProc = function _midiProc( timestamp, data ) {\n        // Have to use createEvent/initEvent because IE10 fails on new CustomEvent.  Thanks, IE!\n        var length = 0;\n        var i,j;\n        var isSysexMessage = false;\n\n        // Jazz sometimes passes us multiple messages at once, so we need to parse them out\n        // and pass them one at a time.\n\n        for (i=0; i<data.length; i+=length) {\n            if (this._inLongSysexMessage) {\n                i = this.bufferLongSysex(data,i);\n                if ( data[i-1] != 0xf7 ) {\n                    // ran off the end without hitting the end of the sysex message\n                    return;\n                }\n                isSysexMessage = true;\n            } else {\n                isSysexMessage = false;\n                switch (data[i] & 0xF0) {\n                    case 0x80:  // note off\n                    case 0x90:  // note on\n                    case 0xA0:  // polyphonic aftertouch\n                    case 0xB0:  // control change\n                    case 0xE0:  // channel mode\n                        length = 3;\n                        break;\n\n                    case 0xC0:  // program change\n                    case 0xD0:  // channel aftertouch\n                        length = 2;\n                        break;\n\n                    case 0xF0:\n                        switch (data[i]) {\n                            case 0xf0:  // variable-length sysex.\n                                i = this.bufferLongSysex(data,i);\n                                if ( data[i-1] != 0xf7 ) {\n                                    // ran off the end without hitting the end of the sysex message\n                                    return;\n                                }\n                                isSysexMessage = true;\n                                break;\n\n                            case 0xF1:  // MTC quarter frame\n                            case 0xF3:  // song select\n                                length = 2;\n                                break;\n\n                            case 0xF2:  // song position pointer\n                                length = 3;\n                                break;\n\n                            default:\n                                length = 1;\n                                break;\n                        }\n                        break;\n                }\n            }\n            var evt = document.createEvent( \"Event\" );\n            evt.initEvent( \"midimessage\", false, false );\n            evt.receivedTime = parseFloat( timestamp.toString()) + this._jazzInstance._perfTimeZero;\n            if (isSysexMessage || this._inLongSysexMessage) {\n                evt.data = new Uint8Array( this._sysexBuffer );\n                this._sysexBuffer = new Uint8Array(0);\n                this._inLongSysexMessage = false;\n            } else\n                evt.data = new Uint8Array(data.slice(i, length+i));\n            this.dispatchEvent( evt );\n        }\n    };\n\n    MIDIOutput = function MIDIOutput( midiAccess, name, index ) {\n        this._listeners = [];\n        this._midiAccess = midiAccess;\n        this._index = index;\n        this.id = \"\" + index + \".\" + name;\n        this.manufacturer = \"\";\n        this.name = name;\n        this.type = \"output\";\n        this.version = \"\";\n\n        var outputInstance = null;\n        for (var i=0; (i<midiAccess._jazzInstances.length)&&(!outputInstance); i++) {\n            if (!midiAccess._jazzInstances[i].outputInUse)\n                outputInstance=midiAccess._jazzInstances[i];\n        }\n        if (!outputInstance) {\n            outputInstance = new _JazzInstance();\n            midiAccess._jazzInstances.push( outputInstance );\n        }\n        outputInstance.outputInUse = true;\n\n        this._jazzInstance = outputInstance._Jazz;\n        this._jazzInstance.MidiOutOpen(this.name);\n    };\n\n    function _sendLater() {\n        this.jazz.MidiOutLong( this.data );    // handle send as sysex\n    }\n\n    MIDIOutput.prototype.send = function( data, timestamp ) {\n        var delayBeforeSend = 0;\n        if (data.length === 0)\n            return false;\n\n        if (timestamp)\n            delayBeforeSend = Math.floor( timestamp - window.performance.now() );\n\n        if (timestamp && (delayBeforeSend>1)) {\n            var sendObj = new Object();\n            sendObj.jazz = this._jazzInstance;\n            sendObj.data = data;\n\n            window.setTimeout( _sendLater.bind(sendObj), delayBeforeSend );\n        } else {\n            this._jazzInstance.MidiOutLong( data );\n        }\n        return true;\n    };\n\n    //init: create plugin\n    if (!window.navigator.requestMIDIAccess)\n        window.navigator.requestMIDIAccess = _requestMIDIAccess;\n\n    module.exports = _requestMIDIAccess;\n}(window));\n\n// Polyfill window.performance.now() if necessary.\n(function (exports) {\n    var perf = {}, props;\n\n    function findAlt() {\n        var prefix = ['moz', 'webkit', 'o', 'ms'],\n        i = prefix.length,\n            //worst case, we use Date.now()\n            props = {\n                value: (function (start) {\n                    return function () {\n                        return Date.now() - start;\n                    };\n                }(Date.now()))\n            };\n\n        //seach for vendor prefixed version\n        for (; i >= 0; i--) {\n            if ((prefix[i] + \"Now\") in exports.performance) {\n                props.value = function (method) {\n                    return function () {\n                        exports.performance[method]();\n                    }\n                }(prefix[i] + \"Now\");\n                return props;\n            }\n        }\n\n        //otherwise, try to use connectionStart\n        if (\"timing\" in exports.performance && \"connectStart\" in exports.performance.timing) {\n            //this pretty much approximates performance.now() to the millisecond\n            props.value = (function (start) {\n                return function() {\n                    Date.now() - start;\n                };\n            }(exports.performance.timing.connectStart));\n        }\n        return props;\n    }\n\n    //if already defined, bail\n    if ((\"performance\" in exports) && (\"now\" in exports.performance))\n        return;\n    if (!(\"performance\" in exports))\n        Object.defineProperty(exports, \"performance\", {\n            get: function () {\n                return perf;\n            }});\n        //otherwise, performance is there, but not \"now()\"\n\n    props = findAlt();\n    Object.defineProperty(exports.performance, \"now\", props);\n}(window));\n","var midi = function () {\n    var api = {};\n    var loader = require('./midi/loader')();\n\n\n    loader.loadPlugin({\n        soundfontUrl: \"./soundfont/\",\n        instrument: \"acoustic_grand_piano\",\n        onprogress: function(state, progress) {\n            console.log(state, progress);\n        },\n        onsuccess: function() {\n            var delay = 0; // play one note every quarter second\n            var note = 50; // the MIDI note\n            var velocity = 127; // how hard the note hits\n            console.log(loader);\n            // play the note\n            loader.player.setVolume(0, 127);\n            loader.player.noteOn(0, note, velocity, delay);\n            loader.player.noteOff(0, note, delay + 0.75);\n        }\n\n\n    });\n    var config = {};\n\n    return api;\n};\nmodule.exports = midi;\nwindow.globalmidi = midi;","/*\n\t----------------------------------------------------------\n\tMIDI.audioDetect : 0.3.2 : 2015-03-26\n\t----------------------------------------------------------\n\thttps://github.com/mudcube/MIDI.js\n\t----------------------------------------------------------\n\tProbably, Maybe, No... Absolutely!\n\tTest to see what types of <audio> MIME types are playable by the browser.\n\t----------------------------------------------------------\n*/\nvar supports = {}; // object of supported file types\nvar pending = 0; // pending file types to process\nvar canPlayThrough = function (src) { // check whether format plays through\n\tpending ++;\n\tvar body = document.body;\n\tvar audio = new Audio();\n\tvar mime = src.split(';')[0];\n\taudio.id = 'audio';\n\taudio.setAttribute('preload', 'auto');\n\taudio.setAttribute('audiobuffer', true);\n\taudio.addEventListener('error', function() {\n\t\tbody.removeChild(audio);\n\t\tsupports[mime] = false;\n\t\tpending --;\n\t}, false);\n\taudio.addEventListener('canplaythrough', function() {\n\t\tbody.removeChild(audio);\n\t\tsupports[mime] = true;\n\t\tpending --;\n\t}, false);\n\taudio.src = 'data:' + src;\n\tbody.appendChild(audio);\n};\n\nvar audioDetect = function(onsuccess) {\n\t/// detect jazz-midi plugin\n\tif (navigator.requestMIDIAccess) {\n\t\tvar isNative = Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf('[native code]');\n\t\tif (isNative) { // has native midiapi support\n\t\t\tsupports['webmidi'] = true;\n\t\t} else { // check for jazz plugin midiapi support\n\t\t\tfor (var n = 0; navigator.plugins.length > n; n ++) {\n\t\t\t\tvar plugin = navigator.plugins[n];\n\t\t\t\tif (plugin.name.indexOf('Jazz-Plugin') >= 0) {\n\t\t\t\t\tsupports['webmidi'] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/// check whether <audio> tag is supported\n\tif (typeof(Audio) === 'undefined') {\n\t\treturn onsuccess({});\n\t} else {\n\t\tsupports['audiotag'] = true;\n\t}\n\n\t/// check for webaudio api support\n\tif (window.AudioContext || window.webkitAudioContext) {\n\t\tsupports['webaudio'] = true;\n\t}\n\n\t/// check whether canPlayType is supported\n\tvar audio = new Audio();\n\tif (typeof(audio.canPlayType) === 'undefined') {\n\t\treturn onsuccess(supports);\n\t}\n\n\t/// see what we can learn from the browser\n\tvar vorbis = audio.canPlayType('audio/ogg; codecs=\"vorbis\"');\n\tvorbis = (vorbis === 'probably' || vorbis === 'maybe');\n\tvar mpeg = audio.canPlayType('audio/mpeg');\n\tmpeg = (mpeg === 'probably' || mpeg === 'maybe');\n\t// maybe nothing is supported\n\tif (!vorbis && !mpeg) {\n\t\tonsuccess(supports);\n\t\treturn;\n\t}\n\n\t/// or maybe something is supported\n\tif (vorbis) canPlayThrough('audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA=');\n\tif (mpeg) canPlayThrough('audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq');\n\n\t/// lets find out!\n\tvar time = (new Date()).getTime();\n\tvar interval = window.setInterval(function() {\n\t\tvar now = (new Date()).getTime();\n\t\tvar maxExecution = now - time > 5000;\n\t\tif (!pending || maxExecution) {\n\t\t\twindow.clearInterval(interval);\n\t\t\tonsuccess(supports);\n\t\t}\n\t}, 1);\n};\n\nmodule.exports = audioDetect;","/*\n ----------------------------------------------------------\n GeneralMIDI\n ----------------------------------------------------------\n */\nvar root = {};\nroot.GM = (function (arr) {\n    var clean = function (name) {\n        return name.replace(/[^a-z0-9 ]/gi, '').replace(/[ ]/g, '_').toLowerCase();\n    };\n    var res = {\n        byName: {},\n        byId: {},\n        byCategory: {}\n    };\n    for (var key in arr) {\n        var list = arr[key];\n        for (var n = 0, length = list.length; n < length; n++) {\n            var instrument = list[n];\n            if (!instrument) continue;\n            var num = parseInt(instrument.substr(0, instrument.indexOf(' ')), 10);\n            instrument = instrument.replace(num + ' ', '');\n            res.byId[--num] =\n                res.byName[clean(instrument)] =\n                    res.byCategory[clean(key)] = {\n                        id: clean(instrument),\n                        instrument: instrument,\n                        number: num,\n                        category: key\n                    };\n        }\n    }\n    return res;\n})({\n    'Piano': ['1 Acoustic Grand Piano', '2 Bright Acoustic Piano', '3 Electric Grand Piano', '4 Honky-tonk Piano', '5 Electric Piano 1', '6 Electric Piano 2', '7 Harpsichord', '8 Clavinet'],\n    'Chromatic Percussion': ['9 Celesta', '10 Glockenspiel', '11 Music Box', '12 Vibraphone', '13 Marimba', '14 Xylophone', '15 Tubular Bells', '16 Dulcimer'],\n    'Organ': ['17 Drawbar Organ', '18 Percussive Organ', '19 Rock Organ', '20 Church Organ', '21 Reed Organ', '22 Accordion', '23 Harmonica', '24 Tango Accordion'],\n    'Guitar': ['25 Acoustic Guitar (nylon)', '26 Acoustic Guitar (steel)', '27 Electric Guitar (jazz)', '28 Electric Guitar (clean)', '29 Electric Guitar (muted)', '30 Overdriven Guitar', '31 Distortion Guitar', '32 Guitar Harmonics'],\n    'Bass': ['33 Acoustic Bass', '34 Electric Bass (finger)', '35 Electric Bass (pick)', '36 Fretless Bass', '37 Slap Bass 1', '38 Slap Bass 2', '39 Synth Bass 1', '40 Synth Bass 2'],\n    'Strings': ['41 Violin', '42 Viola', '43 Cello', '44 Contrabass', '45 Tremolo Strings', '46 Pizzicato Strings', '47 Orchestral Harp', '48 Timpani'],\n    'Ensemble': ['49 String Ensemble 1', '50 String Ensemble 2', '51 Synth Strings 1', '52 Synth Strings 2', '53 Choir Aahs', '54 Voice Oohs', '55 Synth Choir', '56 Orchestra Hit'],\n    'Brass': ['57 Trumpet', '58 Trombone', '59 Tuba', '60 Muted Trumpet', '61 French Horn', '62 Brass Section', '63 Synth Brass 1', '64 Synth Brass 2'],\n    'Reed': ['65 Soprano Sax', '66 Alto Sax', '67 Tenor Sax', '68 Baritone Sax', '69 Oboe', '70 English Horn', '71 Bassoon', '72 Clarinet'],\n    'Pipe': ['73 Piccolo', '74 Flute', '75 Recorder', '76 Pan Flute', '77 Blown Bottle', '78 Shakuhachi', '79 Whistle', '80 Ocarina'],\n    'Synth Lead': ['81 Lead 1 (square)', '82 Lead 2 (sawtooth)', '83 Lead 3 (calliope)', '84 Lead 4 (chiff)', '85 Lead 5 (charang)', '86 Lead 6 (voice)', '87 Lead 7 (fifths)', '88 Lead 8 (bass + lead)'],\n    'Synth Pad': ['89 Pad 1 (new age)', '90 Pad 2 (warm)', '91 Pad 3 (polysynth)', '92 Pad 4 (choir)', '93 Pad 5 (bowed)', '94 Pad 6 (metallic)', '95 Pad 7 (halo)', '96 Pad 8 (sweep)'],\n    'Synth Effects': ['97 FX 1 (rain)', '98 FX 2 (soundtrack)', '99 FX 3 (crystal)', '100 FX 4 (atmosphere)', '101 FX 5 (brightness)', '102 FX 6 (goblins)', '103 FX 7 (echoes)', '104 FX 8 (sci-fi)'],\n    'Ethnic': ['105 Sitar', '106 Banjo', '107 Shamisen', '108 Koto', '109 Kalimba', '110 Bagpipe', '111 Fiddle', '112 Shanai'],\n    'Percussive': ['113 Tinkle Bell', '114 Agogo', '115 Steel Drums', '116 Woodblock', '117 Taiko Drum', '118 Melodic Tom', '119 Synth Drum'],\n    'Sound effects': ['120 Reverse Cymbal', '121 Guitar Fret Noise', '122 Breath Noise', '123 Seashore', '124 Bird Tweet', '125 Telephone Ring', '126 Helicopter', '127 Applause', '128 Gunshot']\n});\n\n/* get/setInstrument\n --------------------------------------------------- */\nroot.getInstrument = function (channelId) {\n    var channel = root.channels[channelId];\n    return channel && channel.instrument;\n};\n\nroot.setInstrument = function (channelId, program, delay) {\n    var channel = root.channels[channelId];\n    if (delay) {\n        return setTimeout(function () {\n            channel.instrument = program;\n        }, delay);\n    } else {\n        channel.instrument = program;\n    }\n};\n\n/* get/setMono\n --------------------------------------------------- */\nroot.getMono = function (channelId) {\n    var channel = root.channels[channelId];\n    return channel && channel.mono;\n};\n\nroot.setMono = function (channelId, truthy, delay) {\n    var channel = root.channels[channelId];\n    if (delay) {\n        return setTimeout(function () {\n            channel.mono = truthy;\n        }, delay);\n    } else {\n        channel.mono = truthy;\n    }\n};\n\n/* get/setOmni\n --------------------------------------------------- */\nroot.getOmni = function (channelId) {\n    var channel = root.channels[channelId];\n    return channel && channel.omni;\n};\n\nroot.setOmni = function (channelId, truthy) {\n    var channel = root.channels[channelId];\n    if (delay) {\n        return setTimeout(function () {\n            channel.omni = truthy;\n        }, delay);\n    } else {\n        channel.omni = truthy;\n    }\n};\n\n/* get/setSolo\n --------------------------------------------------- */\nroot.getSolo = function (channelId) {\n    var channel = root.channels[channelId];\n    return channel && channel.solo;\n};\n\nroot.setSolo = function (channelId, truthy) {\n    var channel = root.channels[channelId];\n    if (delay) {\n        return setTimeout(function () {\n            channel.solo = truthy;\n        }, delay);\n    } else {\n        channel.solo = truthy;\n    }\n};\n\n\n/* note conversions\n --------------------------------------------------- */\nroot.keyToNote = {}; // C8  == 108\nroot.noteToKey = {}; // 108 ==  C8\n\n(function () {\n    var A0 = 0x15; // first note\n    var C8 = 0x6C; // last note\n    var number2key = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n    for (var n = A0; n <= C8; n++) {\n        var octave = (n - 12) / 12 >> 0;\n        var name = number2key[n % 12] + octave;\n        root.keyToNote[name] = n;\n        root.noteToKey[n] = name;\n    }\n})();\n\nmodule.exports = root","/**\n ----------------------------------------------------------\n MIDI.Plugin : 0.3.4 : 2015-03-26\n ----------------------------------------------------------\n https://github.com/mudcube/MIDI.js\n ----------------------------------------------------------\n Inspired by javax.sound.midi (albeit a super simple version):\n http://docs.oracle.com/javase/6/docs/api/javax/sound/midi/package-summary.html\n ----------------------------------------------------------\n Technologies\n ----------------------------------------------------------\n Web MIDI API - no native support yet (jazzplugin)\n Web Audio API - firefox 25+, chrome 10+, safari 6+, opera 15+\n HTML5 Audio Tag - ie 9+, firefox 3.5+, chrome 4+, safari 4+, opera 9.5+, ios 4+, android 2.3+\n ----------------------------------------------------------\n **/\n\n\nmodule.exports = function() {\n    window.MIDI = {};\n    window.MIDI.Soundfont = {};\n    'use strict';\n    var audioDetect = require('./audioDetect');\n    var generalMIDI = require('./gm');\n    var webMidi = require('./plugin.webmidi');\n    var audiotag = require('./plugin.audiotag');\n    var webaudio = require('./plugin.webaudio');\n    var request = require('../util/dom_request_xhr');\n    var dom = require('../util/dom_request_script');\n\n    var root = {};\n    root.DEBUG = true;\n    root.USE_XHR = true;\n    root.soundfontUrl = './soundfont/';\n    root.player;\n    root.channels = (function () { // 0 - 15 channels\n        var channels = {};\n        for (var i = 0; i < 16; i++) {\n            channels[i] = { // default values\n                instrument: i,\n                pitchBend: 0,\n                mute: false,\n                mono: false,\n                omni: false,\n                solo: false\n            };\n        }\n        return channels;\n    })();\n    /*\n     MIDI.loadPlugin({\n     onsuccess: function() { },\n     onprogress: function(state, percent) { },\n     targetFormat: 'mp3', // optionally can force to use MP3 (for instance on mobile networks)\n     instrument: 'acoustic_grand_piano', // or 1 (default)\n     instruments: [ 'acoustic_grand_piano', 'acoustic_guitar_nylon' ] // or multiple instruments\n     });\n     */\n\n    root.loadPlugin = function (opts) {\n        if (typeof opts === 'function') {\n            opts = {onsuccess: opts};\n        }\n\n        root.soundfontUrl = opts.soundfontUrl || root.soundfontUrl;\n\n        /// Detect the best type of audio to use\n        audioDetect(function (supports) {\n            var hash = window.location.hash;\n            var api = '';\n            /// use the most appropriate plugin if not specified\n            if (supports[opts.api]) {\n                api = opts.api;\n            } else if (supports[hash.substr(1)]) {\n                api = hash.substr(1);\n            } else if (supports.webmidi) {\n                api = 'webmidi';\n            } else if (window.AudioContext) { // Chrome\n                api = 'webaudio';\n            } else if (window.Audio) { // Firefox\n                api = 'audiotag';\n            }\n\n            /// use audio/ogg when supported\n            if (opts.targetFormat) {\n                var audioFormat = opts.targetFormat;\n            } else { // use best quality\n                var audioFormat = supports['audio/ogg'] ? 'ogg' : 'mp3';\n            }\n\n            /// load the specified plugin\n            root.__api = api;\n            root.__audioFormat = audioFormat;\n            root.supports = supports;\n            root.loadResource(opts);\n        });\n    };\n\n    /*\n     root.loadResource({\n     onsuccess: function() { },\n     onprogress: function(state, percent) { },\n     instrument: 'banjo'\n     })\n     */\n\n    root.loadResource = function (opts) {\n        var instruments = opts.instruments || opts.instrument || 'acoustic_grand_piano';\n        ///\n        if (typeof instruments !== 'object') {\n            if (instruments || instruments === 0) {\n                instruments = [instruments];\n            } else {\n                instruments = [];\n            }\n        }\n        /// convert numeric ids into strings\n        for (var i = 0; i < instruments.length; i++) {\n            var instrument = instruments[i];\n            if (instrument === +instrument) { // is numeric\n                if (generalMIDI.GM.byId[instrument]) {\n                    instruments[i] = generalMIDI.GM.byId[instrument].id;\n                }\n            }\n        }\n        ///\n        opts.format = root.__audioFormat;\n        opts.instruments = instruments;\n\n        ///\n        root.midi = connect(root.__api, opts);\n    };\n\n    var connect = function(api, opts){\n        if (window.AudioContext) { // Chrome\n            api = 'webaudio';\n        } else if (window.Audio) { // Firefox\n            api = 'audiotag';\n        } else { // no support\n            //return;\n        }\n\n        switch(api) {\n            case 'webmidi':\n                // cant wait for this to be standardized!\n                root.player = webMidi.connect(opts);\n                break;\n            case 'audiotag':\n                // works ok, kinda like a drunken tuna fish, across the board\n                // http://caniuse.com/audio\n                requestQueue(opts, audiotag);\n                break;\n            case 'webaudio':\n                // works awesome! safari, chrome and firefox support\n                // http://caniuse.com/web-audio\n                requestQueue(opts, webaudio);\n                break;\n        }\n    };\n\n    var requestQueue = function (opts, context) {\n        var audioFormat = opts.format;\n        var instruments = opts.instruments;\n        var onprogress = opts.onprogress;\n        var onerror = opts.onerror;\n        ///\n        var length = instruments.length;\n        var pending = length;\n        var waitForEnd = function () {\n            if (!--pending) {\n                onprogress && onprogress('load', 1.0);\n                root.player = context.connect(opts, root.channels);\n            }\n        };\n        ///\n        for (var i = 0; i < length; i++) {\n            var instrumentId = instruments[i];\n            if (window.MIDI.Soundfont[instrumentId]) { // already loaded\n                waitForEnd();\n            } else { // needs to be requested\n                sendRequest(instruments[i], audioFormat, function (evt, progress) {\n                    var fileProgress = progress / length;\n                    var queueProgress = (length - pending) / length;\n                    onprogress && onprogress('load', fileProgress + queueProgress, instrumentId);\n                }, function () {\n                    waitForEnd();\n                }, onerror);\n            }\n        };\n    };\n\n    var sendRequest = function (instrumentId, audioFormat, onprogress, onsuccess, onerror) {\n        var soundfontPath = root.soundfontUrl + instrumentId + '-' + audioFormat + '.js';\n\n        if (root.USE_XHR) {\n            request({\n                url: soundfontPath,\n                format: 'text',\n                onerror: onerror,\n                onprogress: onprogress,\n                onsuccess: function (event, responseText) {\n                    var script = document.createElement('script');\n                    script.language = 'javascript';\n                    script.type = 'text/javascript';\n                    script.text = responseText;\n                    document.body.appendChild(script);\n\n                    ///\n                    onsuccess();\n                }\n            });\n        } else {\n            dom.loadScript.add({\n                url: soundfontPath,\n                verify: 'MIDI.Soundfont[\"' + instrumentId + '\"]',\n                onerror: onerror,\n                onsuccess: function () {\n                    onsuccess();\n                }\n            });\n        }\n    };\n\n    root.setDefaultPlugin = function (midi) {\n        for (var key in midi) {\n            root[key] = midi[key];\n        }\n    };\n\n    return root;\n};","/*\n ----------------------------------------------------------------------\n AudioTag <audio> - OGG or MPEG Soundbank\n ----------------------------------------------------------------------\n http://dev.w3.org/html5/spec/Overview.html#the-audio-element\n ----------------------------------------------------------------------\n */\n\nmodule.exports = function () {\n    'use strict';\n\n    return window.Audio && (function () {\n        var midi = {api: 'audiotag'};\n        var noteToKey = {};\n        var volume = 127; // floating point\n        var buffer_nid = -1; // current channel\n        var audioBuffers = []; // the audio channels\n        var notesOn = []; // instrumentId + noteId that is currently playing in each 'channel', for routing noteOff/chordOff calls\n        var notes = {}; // the piano keys\n        for (var nid = 0; nid < 12; nid++) {\n            audioBuffers[nid] = new Audio();\n        }\n\n        var playChannel = function (channel, note) {\n            if (!root.channels[channel]) return;\n            var instrument = root.channels[channel].instrument;\n            var instrumentId = root.GM.byId[instrument].id;\n            var note = notes[note];\n            if (note) {\n                var instrumentNoteId = instrumentId + '' + note.id;\n                var nid = (buffer_nid + 1) % audioBuffers.length;\n                var audio = audioBuffers[nid];\n                notesOn[nid] = instrumentNoteId;\n                if (!root.Soundfont[instrumentId]) {\n                    if (root.DEBUG) {\n                        console.log('404', instrumentId);\n                    }\n                    return;\n                }\n                audio.src = root.Soundfont[instrumentId][note.id];\n                audio.volume = volume / 127;\n                audio.play();\n                buffer_nid = nid;\n            }\n        };\n\n        var stopChannel = function (channel, note) {\n            if (!root.channels[channel]) return;\n            var instrument = root.channels[channel].instrument;\n            var instrumentId = root.GM.byId[instrument].id;\n            var note = notes[note];\n            if (note) {\n                var instrumentNoteId = instrumentId + '' + note.id;\n                for (var i = 0, len = audioBuffers.length; i < len; i++) {\n                    var nid = (i + buffer_nid + 1) % len;\n                    var cId = notesOn[nid];\n                    if (cId && cId == instrumentNoteId) {\n                        audioBuffers[nid].pause();\n                        notesOn[nid] = null;\n                        return;\n                    }\n                }\n            }\n        };\n\n        midi.audioBuffers = audioBuffers;\n        midi.send = function (data, delay) {\n        };\n        midi.setController = function (channel, type, value, delay) {\n        };\n        midi.setVolume = function (channel, n) {\n            volume = n; //- should be channel specific volume\n        };\n\n        midi.programChange = function (channel, program) {\n            root.channels[channel].instrument = program;\n        };\n\n        midi.pitchBend = function (channel, program, delay) {\n        };\n\n        midi.noteOn = function (channel, note, velocity, delay) {\n            var id = noteToKey[note];\n            if (!notes[id]) return;\n            if (delay) {\n                return setTimeout(function () {\n                    playChannel(channel, id);\n                }, delay * 1000);\n            } else {\n                playChannel(channel, id);\n            }\n        };\n\n        midi.noteOff = function (channel, note, delay) {\n// \t\t\tvar id = noteToKey[note];\n// \t\t\tif (!notes[id]) return;\n// \t\t\tif (delay) {\n// \t\t\t\treturn setTimeout(function() {\n// \t\t\t\t\tstopChannel(channel, id);\n// \t\t\t\t}, delay * 1000)\n// \t\t\t} else {\n// \t\t\t\tstopChannel(channel, id);\n// \t\t\t}\n        };\n\n        midi.chordOn = function (channel, chord, velocity, delay) {\n            for (var idx = 0; idx < chord.length; idx++) {\n                var n = chord[idx];\n                var id = noteToKey[n];\n                if (!notes[id]) continue;\n                if (delay) {\n                    return setTimeout(function () {\n                        playChannel(channel, id);\n                    }, delay * 1000);\n                } else {\n                    playChannel(channel, id);\n                }\n            }\n        };\n\n        midi.chordOff = function (channel, chord, delay) {\n            for (var idx = 0; idx < chord.length; idx++) {\n                var n = chord[idx];\n                var id = noteToKey[n];\n                if (!notes[id]) continue;\n                if (delay) {\n                    return setTimeout(function () {\n                        stopChannel(channel, id);\n                    }, delay * 1000);\n                } else {\n                    stopChannel(channel, id);\n                }\n            }\n        };\n\n        midi.stopAllNotes = function () {\n            for (var nid = 0, length = audioBuffers.length; nid < length; nid++) {\n                audioBuffers[nid].pause();\n            }\n        };\n\n        midi.connect = function (opts) {\n            root.setDefaultPlugin(midi);\n            ///\n            for (var key in root.keyToNote) {\n                noteToKey[root.keyToNote[key]] = key;\n                notes[key] = {id: key};\n            }\n            ///\n            opts.onsuccess && opts.onsuccess();\n        };\n\n        return midi;\n    })();\n\n};","/*\n ----------------------------------------------------------\n Web Audio API - OGG or MPEG Soundbank\n ----------------------------------------------------------\n http://webaudio.github.io/web-audio-api/\n ----------------------------------------------------------\n */\n\n\n'use strict';\nvar generalMIDI = require('./gm');\nvar Base64Binary = require('../lib/Base64binary');\nvar Tuna = require('tunajs');\nvar audioContext = null; // new AudioContext();\nvar useStreamingBuffer = false; // !!audioContext.createMediaElementSource;\nvar midi = {api: 'webaudio'};\nvar ctx; // audio context\nvar sources = {};\nvar effects = {};\nvar masterVolume = 127;\nvar audioBuffers = {};\nvar channels;\n///\nmidi.audioBuffers = audioBuffers;\nmidi.send = function (data, delay) {\n};\nmidi.setController = function (channelId, type, value, delay) {\n};\n\nmidi.setVolume = function (channelId, volume, delay) {\n    if (delay) {\n        setTimeout(function () {\n            masterVolume = volume;\n        }, delay * 1000);\n    } else {\n        masterVolume = volume;\n    }\n};\n\nmidi.programChange = function (channelId, program, delay) {\n// \t\t\tif (delay) {\n// \t\t\t\treturn setTimeout(function() {\n// \t\t\t\t\tvar channel = channels[channelId];\n// \t\t\t\t\tchannel.instrument = program;\n// \t\t\t\t}, delay);\n// \t\t\t} else {\n    var channel = channels[channelId];\n    channel.instrument = program;\n// \t\t\t}\n};\n\nmidi.pitchBend = function (channelId, program, delay) {\n// \t\t\tif (delay) {\n// \t\t\t\tsetTimeout(function() {\n// \t\t\t\t\tvar channel = channels[channelId];\n// \t\t\t\t\tchannel.pitchBend = program;\n// \t\t\t\t}, delay);\n// \t\t\t} else {\n    var channel = channels[channelId];\n    channel.pitchBend = program;\n// \t\t\t}\n};\n\nmidi.noteOn = function (channelId, noteId, velocity, delay) {\n    delay = delay || 0;\n\n    /// check whether the note exists\n    var channel = channels[channelId];\n\n    var instrument = channel.instrument;\n    var bufferId = instrument + '' + noteId;\n\n    var buffer = audioBuffers[bufferId];\n    if (!buffer) {\n\t\t//console.log(generalMIDI.GM.byId[instrument].id, instrument, channelId);\n        return;\n    }\n\n\n    /// convert relative delay to absolute delay\n    if (delay < ctx.currentTime) {\n        delay += ctx.currentTime;\n    }\n    /// create audio buffer\n    if (useStreamingBuffer) {\n        var source = ctx.createMediaElementSource(buffer);\n    } else { // XMLHTTP buffer\n        var source = ctx.createBufferSource();\n        source.buffer = buffer;\n    }\n\n    /// add effects to buffer\n    if (effects) {\n        var chain = source;\n        for (var key in effects) {\n            chain.connect(effects[key].input);\n            chain = effects[key];\n        }\n    }\n\n    /// add gain + pitchShift\n    var gain = (velocity / 127) * (masterVolume / 127) * 2 - 1;\n    source.connect(ctx.destination);\n    source.playbackRate.value = 1; // pitch shift\n    source.gainNode = ctx.createGain(); // gain\n    source.gainNode.connect(ctx.destination);\n    source.gainNode.gain.value = Math.min(1.0, Math.max(-1.0, gain));\n    source.connect(source.gainNode);\n    ///\n    if (useStreamingBuffer) {\n        if (delay) {\n            return setTimeout(function () {\n                buffer.currentTime = 0;\n                buffer.play()\n            }, delay * 1000);\n        } else {\n            buffer.currentTime = 0;\n            buffer.play()\n        }\n    } else {\n        source.start(delay || 0);\n    }\n    ///\n    sources[channelId + '' + noteId] = source;\n    ///\n    return source;\n};\n\nmidi.noteOff = function (channelId, noteId, delay) {\n    delay = delay || 0;\n\n    /// check whether the note exists\n    var channel = channels[channelId];\n    var instrument = channel.instrument;\n    var bufferId = instrument + '' + noteId;\n    var buffer = audioBuffers[bufferId];\n    if (buffer) {\n        if (delay < ctx.currentTime) {\n            delay += ctx.currentTime;\n        }\n        ///\n        var source = sources[channelId + '' + noteId];\n        if (source) {\n            if (source.gainNode) {\n                // @Miranet: 'the values of 0.2 and 0.3 could of course be used as\n                // a 'release' parameter for ADSR like time settings.'\n                // add { 'metadata': { release: 0.3 } } to soundfont files\n                var gain = source.gainNode.gain;\n                gain.linearRampToValueAtTime(gain.value, delay);\n                gain.linearRampToValueAtTime(-1.0, delay + 0.3);\n            }\n            ///\n            if (useStreamingBuffer) {\n                if (delay) {\n                    setTimeout(function () {\n                        buffer.pause();\n                    }, delay * 1000);\n                } else {\n                    buffer.pause();\n                }\n            } else {\n                if (source.noteOff) {\n                    source.noteOff(delay + 0.5);\n                } else {\n                    source.stop(delay + 0.5);\n                }\n            }\n            ///\n            delete sources[channelId + '' + noteId];\n            ///\n            return source;\n        }\n    }\n};\n\nmidi.chordOn = function (channel, chord, velocity, delay) {\n    var res = {};\n    for (var n = 0, note, len = chord.length; n < len; n++) {\n        res[note = chord[n]] = midi.noteOn(channel, note, velocity, delay);\n    }\n    return res;\n};\n\nmidi.chordOff = function (channel, chord, delay) {\n    var res = {};\n    for (var n = 0, note, len = chord.length; n < len; n++) {\n        res[note = chord[n]] = midi.noteOff(channel, note, delay);\n    }\n    return res;\n};\n\nmidi.stopAllNotes = function () {\n    for (var sid in sources) {\n        var delay = 0;\n        if (delay < ctx.currentTime) {\n            delay += ctx.currentTime;\n        }\n        var source = sources[sid];\n        source.gain.linearRampToValueAtTime(1, delay);\n        source.gain.linearRampToValueAtTime(0, delay + 0.3);\n        if (source.noteOff) { // old api\n            source.noteOff(delay + 0.3);\n        } else { // new api\n            source.stop(delay + 0.3);\n        }\n        delete sources[sid];\n    }\n};\n\nmidi.setEffects = function (list) {\n    if (ctx.tunajs) {\n        for (var n = 0; n < list.length; n++) {\n            var data = list[n];\n            var effect = new ctx.tunajs[data.type](data);\n            effect.connect(ctx.destination);\n            effects[data.type] = effect;\n        }\n    } else {\n        return console.log('Effects module not installed.');\n    }\n};\n\nmidi.connect = function (opts, _channels_) {\n    //root.setDefaultPlugin(midi);\n    channels = _channels_;\n    midi.setContext(ctx || createAudioContext(), opts.onsuccess);\n    return this;\n};\n\nmidi.getContext = function () {\n    return ctx;\n};\n\nmidi.setContext = function (newCtx, onload, onprogress, onerror) {\n\n    ctx = newCtx;\n    /// tuna.js effects module - https://github.com/Dinahmoe/tuna\n    if (typeof Tuna !== 'undefined' && !ctx.tunajs) {\n        ctx.tunajs = new Tuna(ctx);\n    }\n    /// loading audio files\n    var urls = [];\n    var notes = generalMIDI.keyToNote;\n    for (var key in notes) urls.push(key);\n    ///\n    var waitForEnd = function (instrument) {\n        for (var key in bufferPending) { // has pending items\n            if (bufferPending[key]) return;\n        }\n        ///\n        if (onload) { // run onload once\n            onload();\n            onload = null;\n        }\n    };\n    ///\n    var requestAudio = function (soundfont, instrumentId, index, key) {\n        var url = soundfont[key];\n        if (url) {\n            bufferPending[instrumentId]++;\n            loadAudio(url, function (buffer) {\n                buffer.id = key;\n                var noteId = generalMIDI.keyToNote[key];\n                audioBuffers[instrumentId + '' + noteId] = buffer;\n                ///\n                if (--bufferPending[instrumentId] === 0) {\n                    var percent = index / 87;\n// \t\t\t\t\t\t\tconsole.log(MIDI.GM.byId[instrumentId], 'processing: ', percent);\n                    soundfont.isLoaded = true;\n                    waitForEnd(instrument);\n                }\n            }, function (err) {\n                // \t\t\t\tconsole.log(err);\n            });\n        }\n    };\n    ///\n    var bufferPending = {};\n\n    for (var instrument in window.MIDI.Soundfont) {\n        var soundfont = window.MIDI.Soundfont[instrument];\n\n        if (soundfont.isLoaded) {\n            continue;\n        }\n        ///\n        var synth = generalMIDI.GM.byName[instrument];\n        var instrumentId = synth.number;\n        ///\n        bufferPending[instrumentId] = 0;\n        ///\n        for (var index = 0; index < urls.length; index++) {\n            var key = urls[index];\n            requestAudio(soundfont, instrumentId, index, key);\n        }\n    }\n    ///\n    setTimeout(waitForEnd, 1);\n};\n\n/* Load audio file: streaming | base64 | arraybuffer\n ---------------------------------------------------------------------- */\nfunction loadAudio(url, onload, onerror) {\n    if (useStreamingBuffer) {\n        var audio = new Audio();\n        audio.src = url;\n        audio.controls = false;\n        audio.autoplay = false;\n        audio.preload = false;\n        audio.addEventListener('canplay', function () {\n            onload && onload(audio);\n        });\n        audio.addEventListener('error', function (err) {\n            onerror && onerror(err);\n        });\n        document.body.appendChild(audio);\n    } else if (url.indexOf('data:audio') === 0) { // Base64 string\n        var base64 = url.split(',')[1];\n        var buffer = Base64Binary.decodeArrayBuffer(base64);\n        ctx.decodeAudioData(buffer, onload, onerror);\n    } else { // XMLHTTP buffer\n        var request = new XMLHttpRequest();\n        request.open('GET', url, true);\n        request.responseType = 'arraybuffer';\n        request.onload = function () {\n            ctx.decodeAudioData(request.response, onload, onerror);\n        };\n        request.send();\n    }\n};\n\nfunction createAudioContext() {\n    return new (window.AudioContext || window.webkitAudioContext)();\n};\n\nmodule.exports = midi;","/*\n ----------------------------------------------------------------------\n Web MIDI API - Native Soundbanks\n ----------------------------------------------------------------------\n http://webaudio.github.io/web-midi-api/\n ----------------------------------------------------------------------\n */\n'use strict';\nvar requestMIDIAccess = require('../lib/WebMIDIAPI');\nvar plugin = null;\nvar output = null;\nvar channels = [];\nvar midi = {api: 'webmidi'};\nmidi.send = function (data, delay) { // set channel volume\n    output.send(data, delay * 1000);\n};\n\nmidi.setController = function (channel, type, value, delay) {\n    output.send([channel, type, value], delay * 1000);\n};\n\nmidi.setVolume = function (channel, volume, delay) { // set channel volume\n    output.send([0xB0 + channel, 0x07, volume], delay * 1000);\n};\n\nmidi.programChange = function (channel, program, delay) { // change patch (instrument)\n    output.send([0xC0 + channel, program], delay * 1000);\n};\n\nmidi.pitchBend = function (channel, program, delay) { // pitch bend\n    output.send([0xE0 + channel, program], delay * 1000);\n};\n\nmidi.noteOn = function (channel, note, velocity, delay) {\n    output.send([0x90 + channel, note, velocity], delay * 1000);\n};\n\nmidi.noteOff = function (channel, note, delay) {\n    output.send([0x80 + channel, note, 0], delay * 1000);\n};\n\nmidi.chordOn = function (channel, chord, velocity, delay) {\n    for (var n = 0; n < chord.length; n++) {\n        var note = chord[n];\n        output.send([0x90 + channel, note, velocity], delay * 1000);\n    }\n};\n\nmidi.chordOff = function (channel, chord, delay) {\n    for (var n = 0; n < chord.length; n++) {\n        var note = chord[n];\n        output.send([0x80 + channel, note, 0], delay * 1000);\n    }\n};\n\nmidi.stopAllNotes = function () {\n    output.cancel();\n    for (var channel = 0; channel < 16; channel++) {\n        output.send([0xB0 + channel, 0x7B, 0]);\n    }\n};\n\nmidi.connect = function (opts) {\n    //root.setDefaultPlugin(midi);\n    var errFunction = function (err) { // well at least we tried!\n        /*\n        if (window.AudioContext) { // Chrome\n            opts.api = 'webaudio';\n        } else if (window.Audio) { // Firefox\n            opts.api = 'audiotag';\n        } else { // no support\n            return;\n        }\n        root.loadPlugin(opts);\n        */\n    };\n    ///\n    requestMIDIAccess().then(function (access) {\n        plugin = access;\n        var pluginOutputs = plugin.outputs;\n        if (typeof pluginOutputs == 'function') { // Chrome pre-43\n            output = pluginOutputs()[0];\n        } else { // Chrome post-43\n            output = pluginOutputs[0];\n        }\n        if (output === undefined) { // nothing there...\n            errFunction();\n        } else {\n            opts.onsuccess && opts.onsuccess();\n        }\n    }, errFunction);\n};\n\nmodule.exports = midi;","/*\n\t-----------------------------------------------------------\n\tdom.loadScript.js : 0.1.4 : 2014/02/12 : http://mudcu.be\n\t-----------------------------------------------------------\n\tCopyright 2011-2014 Mudcube. All rights reserved.\n\t-----------------------------------------------------------\n\t/// No verification\n\tdom.loadScript.add(\"../js/jszip/jszip.js\");\n\t/// Strict loading order and verification.\n\tdom.loadScript.add({\n\t\tstrictOrder: true,\n\t\turls: [\n\t\t\t{\n\t\t\t\turl: \"../js/jszip/jszip.js\",\n\t\t\t\tverify: \"JSZip\",\n\t\t\t\tonsuccess: function() {\n\t\t\t\t\tconsole.log(1)\n\t\t\t\t}\n\t\t\t},\n\t\t\t{ \n\t\t\t\turl: \"../inc/downloadify/js/swfobject.js\",\n\t\t\t\tverify: \"swfobject\",\n\t\t\t\tonsuccess: function() {\n\t\t\t\t\tconsole.log(2)\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t\tonsuccess: function() {\n\t\t\tconsole.log(3)\n\t\t}\n\t});\n\t/// Just verification.\n\tdom.loadScript.add({\n\t\turl: \"../js/jszip/jszip.js\",\n\t\tverify: \"JSZip\",\n\t\tonsuccess: function() {\n\t\t\tconsole.log(1)\n\t\t}\n\t});\n*/\n\nif (typeof(dom) === \"undefined\") var dom = {};\n\n(function() { \"use strict\";\n\ndom.loadScript = function() {\n\tthis.loaded = {};\n\tthis.loading = {};\n\treturn this;\n};\n\ndom.loadScript.prototype.add = function(config) {\n\tvar that = this;\n\tif (typeof(config) === \"string\") {\n\t\tconfig = { url: config };\n\t}\n\tvar urls = config.urls;\n\tif (typeof(urls) === \"undefined\") {\n\t\turls = [{ \n\t\t\turl: config.url, \n\t\t\tverify: config.verify\n\t\t}];\n\t}\n\t/// adding the elements to the head\n\tvar doc = document.getElementsByTagName(\"head\")[0];\n\t/// \n\tvar testElement = function(element, test) {\n\t\tif (that.loaded[element.url]) return;\n\t\tif (test && globalExists(test) === false) return;\n\t\tthat.loaded[element.url] = true;\n\t\t//\n\t\tif (that.loading[element.url]) that.loading[element.url]();\n\t\tdelete that.loading[element.url];\n\t\t//\n\t\tif (element.onsuccess) element.onsuccess();\n\t\tif (typeof(getNext) !== \"undefined\") getNext();\n\t};\n\t///\n\tvar hasError = false;\n\tvar batchTest = [];\n\tvar addElement = function(element) {\n\t\tif (typeof(element) === \"string\") {\n\t\t\telement = {\n\t\t\t\turl: element,\n\t\t\t\tverify: config.verify\n\t\t\t};\n\t\t}\n\t\tif (/([\\w\\d.\\[\\]\\'\\\"])$/.test(element.verify)) { // check whether its a variable reference\n\t\t\tvar verify = element.test = element.verify;\n\t\t\tif (typeof(verify) === \"object\") {\n\t\t\t\tfor (var n = 0; n < verify.length; n ++) {\n\t\t\t\t\tbatchTest.push(verify[n]);\n\t\t\t\t}\t\t\t\n\t\t\t} else {\n\t\t\t\tbatchTest.push(verify);\n\t\t\t}\n\t\t}\n\t\tif (that.loaded[element.url]) return;\n\t\tvar script = document.createElement(\"script\");\n\t\tscript.onreadystatechange = function() {\n\t\t\tif (this.readyState !== \"loaded\" && this.readyState !== \"complete\") return;\n\t\t\ttestElement(element);\n\t\t};\n\t\tscript.onload = function() {\n\t\t\ttestElement(element);\n\t\t};\n\t\tscript.onerror = function() {\n\t\t\thasError = true;\n\t\t\tdelete that.loading[element.url];\n\t\t\tif (typeof(element.test) === \"object\") {\n\t\t\t\tfor (var key in element.test) {\n\t\t\t\t\tremoveTest(element.test[key]);\n\t\t\t\t}\t\t\t\n\t\t\t} else {\n\t\t\t\tremoveTest(element.test);\n\t\t\t}\n\t\t};\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\n\t\tscript.setAttribute(\"src\", element.url);\n\t\tdoc.appendChild(script);\n\t\tthat.loading[element.url] = function() {};\n\t};\n\t/// checking to see whether everything loaded properly\n\tvar removeTest = function(test) {\n\t\tvar ret = [];\n\t\tfor (var n = 0; n < batchTest.length; n ++) {\n\t\t\tif (batchTest[n] === test) continue;\n\t\t\tret.push(batchTest[n]);\n\t\t}\n\t\tbatchTest = ret;\n\t};\n\tvar onLoad = function(element) {\n\t\tif (element) {\n\t\t\ttestElement(element, element.test);\n\t\t} else {\n\t\t\tfor (var n = 0; n < urls.length; n ++) {\n\t\t\t\ttestElement(urls[n], urls[n].test);\n\t\t\t}\n\t\t}\n\t\tvar istrue = true;\n\t\tfor (var n = 0; n < batchTest.length; n ++) {\n\t\t\tif (globalExists(batchTest[n]) === false) {\n\t\t\t\tistrue = false;\n\t\t\t}\n\t\t}\n\t\tif (!config.strictOrder && istrue) { // finished loading all the requested scripts\n\t\t\tif (hasError) {\n\t\t\t\tif (config.error) {\n\t\t\t\t\tconfig.error();\n\t\t\t\t}\n\t\t\t} else if (config.onsuccess) {\n\t\t\t\tconfig.onsuccess();\n\t\t\t}\n\t\t} else { // keep calling back the function\n\t\t\tsetTimeout(function() { //- should get slower over time?\n\t\t\t\tonLoad(element);\n\t\t\t}, 10);\n\t\t}\n\t};\n\t/// loading methods;  strict ordering or loose ordering\n\tif (config.strictOrder) {\n\t\tvar ID = -1;\n\t\tvar getNext = function() {\n\t\t\tID ++;\n\t\t\tif (!urls[ID]) { // all elements are loaded\n\t\t\t\tif (hasError) {\n\t\t\t\t\tif (config.error) {\n\t\t\t\t\t\tconfig.error();\n\t\t\t\t\t}\n\t\t\t\t} else if (config.onsuccess) {\n\t\t\t\t\tconfig.onsuccess();\n\t\t\t\t}\n\t\t\t} else { // loading new script\n\t\t\t\tvar element = urls[ID];\n\t\t\t\tvar url = element.url;\n\t\t\t\tif (that.loading[url]) { // already loading from another call (attach to event)\n\t\t\t\t\tthat.loading[url] = function() {\n\t\t\t\t\t\tif (element.onsuccess) element.onsuccess();\n\t\t\t\t\t\tgetNext();\n\t\t\t\t\t}\n\t\t\t\t} else if (!that.loaded[url]) { // create script element\n\t\t\t\t\taddElement(element);\n\t\t\t\t\tonLoad(element);\n\t\t\t\t} else { // it's already been successfully loaded\n\t\t\t\t\tgetNext();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tgetNext();\n\t} else { // loose ordering\n\t\tfor (var ID = 0; ID < urls.length; ID ++) {\n\t\t\taddElement(urls[ID]);\n\t\t\tonLoad(urls[ID]);\n\t\t}\n\t}\n};\n\ndom.loadScript = new dom.loadScript();\n\nvar globalExists = function(path, root) {\n\ttry {\n\t\tpath = path.split('\"').join('').split(\"'\").join('').split(']').join('').split('[').join('.');\n\t\tvar parts = path.split(\".\");\n\t\tvar length = parts.length;\n\t\tvar object = root || window;\n\t\tfor (var n = 0; n < length; n ++) {\n\t\t\tvar key = parts[n];\n\t\t\tif (object[key] == null) {\n\t\t\t\treturn false;\n\t\t\t} else { //\n\t\t\t\tobject = object[key];\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t} catch(e) {\n\t\treturn false;\n\t}\n};\n\n})();\n\n/// For NodeJS\nif (typeof (module) !== \"undefined\" && module.exports) {\n\tmodule.exports = dom;\n}","/*\n ----------------------------------------------------------\n util/Request : 0.1.1 : 2015-03-26\n ----------------------------------------------------------\n util.request({\n url: './dir/something.extension',\n data: 'test!',\n format: 'text', // text | xml | json | binary\n responseType: 'text', // arraybuffer | blob | document | json | text\n headers: {},\n withCredentials: true, // true | false\n ///\n onerror: function(evt, percent) {\n console.log(evt);\n },\n onsuccess: function(evt, responseText) {\n console.log(responseText);\n },\n onprogress: function(evt, percent) {\n percent = Math.round(percent * 100);\n loader.create('thread', 'loading... ', percent);\n }\n });\n */\n\n\n\n\nvar request = function (opts, onsuccess, onerror, onprogress) {\n    'use strict';\n    if (typeof opts === 'string') opts = {url: opts};\n    ///\n    var data = opts.data;\n    var url = opts.url;\n    var method = opts.method || (opts.data ? 'POST' : 'GET');\n    var format = opts.format;\n    var headers = opts.headers;\n    var responseType = opts.responseType;\n    var withCredentials = opts.withCredentials || false;\n    ///\n    var onsuccess = onsuccess || opts.onsuccess;\n    var onerror = onerror || opts.onerror;\n    var onprogress = onprogress || opts.onprogress;\n    ///\n    if (typeof NodeFS !== 'undefined' && root.loc.isLocalUrl(url)) {\n        NodeFS.readFile(url, 'utf8', function (err, res) {\n            if (err) {\n                onerror && onerror(err);\n            } else {\n                onsuccess && onsuccess({responseText: res});\n            }\n        });\n        return;\n    }\n    ///\n    var xhr = new XMLHttpRequest();\n    xhr.open(method, url, true);\n    ///\n    if (headers) {\n        for (var type in headers) {\n            xhr.setRequestHeader(type, headers[type]);\n        }\n    } else if (data) { // set the default headers for POST\n        xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n    }\n    if (format === 'binary') { //- default to responseType=\"blob\" when supported\n        if (xhr.overrideMimeType) {\n            xhr.overrideMimeType('text/plain; charset=x-user-defined');\n        }\n    }\n    if (responseType) {\n        xhr.responseType = responseType;\n    }\n    if (withCredentials) {\n        xhr.withCredentials = 'true';\n    }\n    if (onerror && 'onerror' in xhr) {\n        xhr.onerror = onerror;\n    }\n    if (onprogress && xhr.upload && 'onprogress' in xhr.upload) {\n        if (data) {\n            xhr.upload.onprogress = function (evt) {\n                onprogress.call(xhr, evt, event.loaded / event.total);\n            };\n        } else {\n            xhr.addEventListener('progress', function (evt) {\n                var totalBytes = 0;\n                if (evt.lengthComputable) {\n                    totalBytes = evt.total;\n                } else if (xhr.totalBytes) {\n                    totalBytes = xhr.totalBytes;\n                } else {\n                    var rawBytes = parseInt(xhr.getResponseHeader('Content-Length-Raw'));\n                    if (isFinite(rawBytes)) {\n                        xhr.totalBytes = totalBytes = rawBytes;\n                    } else {\n                        return;\n                    }\n                }\n                onprogress.call(xhr, evt, evt.loaded / totalBytes);\n            });\n        }\n    }\n    ///\n    xhr.onreadystatechange = function (evt) {\n        if (xhr.readyState === 4) { // The request is complete\n            if (xhr.status === 200 || // Response OK\n                xhr.status === 304 || // Not Modified\n                xhr.status === 308 || // Permanent Redirect\n                xhr.status === 0 && root.client.cordova // Cordova quirk\n            ) {\n                if (onsuccess) {\n                    var res;\n                    if (format === 'xml') {\n                        res = evt.target.responseXML;\n                    } else if (format === 'text') {\n                        res = evt.target.responseText;\n                    } else if (format === 'json') {\n                        try {\n                            res = JSON.parse(evt.target.response);\n                        } catch (err) {\n                            onerror && onerror.call(xhr, evt);\n                        }\n                    }\n                    ///\n                    onsuccess.call(xhr, evt, res);\n                }\n            } else {\n                onerror && onerror.call(xhr, evt);\n            }\n        }\n    };\n    xhr.send(data);\n    return xhr;\n};\n\nmodule.exports = request;\n"]}